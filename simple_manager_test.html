<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Manager Reviews Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .alert { padding: 15px; margin: 10px 0; border-radius: 4px; }
        .alert-success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .alert-danger { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .alert-info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .loading { text-align: center; padding: 40px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Simple Manager Reviews Test</h1>
        
        <div class="card">
            <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <p>–í—Å–µ–≥–æ –æ—Ç–∑—ã–≤–æ–≤: <strong id="total-reviews">-</strong></p>
            <p>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥: <strong id="average-rating">-</strong></p>
        </div>
        
        <div class="card">
            <h3>üìù –û—Ç–∑—ã–≤—ã</h3>
            <div id="reviews-container">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤...</p>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h3>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
            <button class="btn btn-primary" onclick="testAPI()">Test API</button>
            <button class="btn btn-success" onclick="testPage()">Test Page</button>
            <button class="btn btn-primary" onclick="loadReviews()">Load Reviews</button>
        </div>
        
        <div class="card">
            <h3>üìã –õ–æ–≥–∏</h3>
            <div id="logs" style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(message) {
            const logs = document.getElementById('logs');
            const time = new Date().toLocaleTimeString();
            logs.innerHTML += `[${time}] ${message}<br>`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        function testPage() {
            log('‚úÖ Page is working! JavaScript is executing.');
            alert('‚úÖ Page is working! JavaScript is executing.');
        }

        async function testAPI() {
            log('üîÑ Testing API...');
            try {
                const response = await fetch('/api/reviews/my-reviews');
                log(`üì° Response status: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log(`üì¶ Response data: ${JSON.stringify(data)}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('total-reviews').textContent = data.count || 0;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç–∑—ã–≤–æ–≤
                const container = document.getElementById('reviews-container');
                if (data.reviews && data.reviews.length > 0) {
                    container.innerHTML = '<div class="alert alert-success">‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç! –ù–∞–π–¥–µ–Ω–æ –æ—Ç–∑—ã–≤–æ–≤: ' + data.reviews.length + '</div>';
                } else {
                    container.innerHTML = '<div class="alert alert-info">‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç! –û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
                }
                
                log('‚úÖ API test completed successfully');
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                document.getElementById('reviews-container').innerHTML = 
                    '<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</div>';
            }
        }

        async function loadReviews() {
            log('üîÑ Loading reviews...');
            const container = document.getElementById('reviews-container');
            container.innerHTML = '<div class="loading"><div class="spinner"></div><p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤...</p></div>';
            
            try {
                const response = await fetch('/api/reviews/my-reviews');
                log(`üì° Response status: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log(`üì¶ Reviews data: ${JSON.stringify(data)}`);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('total-reviews').textContent = data.count || 0;
                document.getElementById('average-rating').textContent = '0.0';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç–∑—ã–≤–æ–≤
                if (data.reviews && data.reviews.length > 0) {
                    let html = '<div class="alert alert-success">‚úÖ –ù–∞–π–¥–µ–Ω–æ –æ—Ç–∑—ã–≤–æ–≤: ' + data.reviews.length + '</div>';
                    data.reviews.forEach((review, index) => {
                        html += `<div class="card"><h5>–û—Ç–∑—ã–≤ ${index + 1}</h5><p>–†–µ–π—Ç–∏–Ω–≥: ${review.rating}</p><p>–°—Ç–∞—Ç—É—Å: ${review.status}</p></div>`;
                    });
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div class="alert alert-info">‚ÑπÔ∏è –û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
                }
                
                log('‚úÖ Reviews loaded successfully');
                
            } catch (error) {
                log(`‚ùå Error loading reviews: ${error.message}`);
                container.innerHTML = '<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message + '</div>';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ DOM loaded, starting initialization...');
            testPage();
            setTimeout(() => {
                log('üîÑ Auto-loading reviews...');
                loadReviews();
            }, 1000);
        });
    </script>
</body>
</html>
