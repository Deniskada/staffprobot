[1mdiff --git a/apps/bot/handlers_div/schedule_handlers.py b/apps/bot/handlers_div/schedule_handlers.py[m
[1mindex bb77f28..83d1d8c 100644[m
[1m--- a/apps/bot/handlers_div/schedule_handlers.py[m
[1m+++ b/apps/bot/handlers_div/schedule_handlers.py[m
[36m@@ -286,9 +286,14 @@[m [masync def handle_view_schedule(update: Update, context: ContextTypes.DEFAULT_TYP[m
             shifts = shifts_result.scalars().all()[m
             [m
             if not shifts:[m
[32m+[m[32m                keyboard = [[InlineKeyboardButton("ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ", callback_data="main_menu")]][m
[32m+[m[32m                reply_markup = InlineKeyboardMarkup(keyboard)[m
[32m+[m[41m                [m
                 await update.callback_query.edit_message_text([m
                     "ðŸ“… **Ð’Ð°ÑˆÐ¸ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¼ÐµÐ½Ñ‹**\n\n"[m
[31m-                    "Ð£ Ð²Ð°Ñ Ð½ÐµÑ‚ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¼ÐµÐ½."[m
[32m+[m[32m                    "Ð£ Ð²Ð°Ñ Ð½ÐµÑ‚ Ð·Ð°Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ñ… ÑÐ¼ÐµÐ½.",[m
[32m+[m[32m                    parse_mode='Markdown',[m
[32m+[m[32m                    reply_markup=reply_markup[m
                 )[m
                 return[m
             [m
[36m@@ -408,21 +413,21 @@[m [masync def handle_cancel_shift(update: Update, context: ContextTypes.DEFAULT_TYPE[m
             [m
             # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ shift_id Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑˆÐ°Ð³Ð°[m
             context.user_data['cancelling_shift_id'] = shift_id[m
[31m-            [m
[31m-            # ÐŸÐ¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñ‹[m
[31m-            keyboard = [[m
[31m-                [InlineKeyboardButton("ðŸ¥ ÐœÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ°Ñ ÑÐ¿Ñ€Ð°Ð²ÐºÐ°", callback_data=f"cancel_reason_medical_cert")],[m
[31m-                [InlineKeyboardButton("ðŸš¨ Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ° Ð¾Ñ‚ ÐœÐ§Ð¡", callback_data=f"cancel_reason_emergency_cert")],[m
[31m-                [InlineKeyboardButton("ðŸ‘® Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ° Ð¾Ñ‚ Ð¿Ð¾Ð»Ð¸Ñ†Ð¸Ð¸", callback_data=f"cancel_reason_police_cert")],[m
[31m-                [InlineKeyboardButton("â“ Ð”Ñ€ÑƒÐ³Ð°Ñ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ð°", callback_data=f"cancel_reason_other")],[m
[31m-                [InlineKeyboardButton("ðŸ”™ ÐžÑ‚Ð¼ÐµÐ½Ð°", callback_data="view_schedule")][m
[31m-            ][m
[31m-            reply_markup = InlineKeyboardMarkup(keyboard)[m
[31m-            [m
[31m-            # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚ Ð´Ð»Ñ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ[m
[32m+[m
[32m+[m[32m            # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¾Ð±ÑŠÐµÐºÑ‚ (Ð½ÑƒÐ¶ÐµÐ½ Ð´Ð»Ñ owner_id Ð¸ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ)[m
             object_query = select(Object).where(Object.id == shift.object_id)[m
             object_result = await session.execute(object_query)[m
             obj = object_result.scalar_one_or_none()[m
[32m+[m[41m            [m
[32m+[m[32m            # Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñ‹ Ð¸Ð· Ð‘Ð” Ð¿Ð¾ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ñƒ Ð¾Ð±ÑŠÐµÐºÑ‚Ð°[m
[32m+[m[32m            from shared.services.cancellation_policy_service import CancellationPolicyService[m
[32m+[m[32m            owner_id = obj.owner_id if obj else None[m
[32m+[m[32m            reasons = await CancellationPolicyService.get_owner_reasons(session, owner_id) if owner_id else [][m
[32m+[m[32m            keyboard_rows = [][m
[32m+[m[32m            for r in reasons:[m
[32m+[m[32m                keyboard_rows.append([InlineKeyboardButton(r.title, callback_data=f"cancel_reason_{r.code}")])[m
[32m+[m[32m            keyboard_rows.append([InlineKeyboardButton("ðŸ”™ ÐžÑ‚Ð¼ÐµÐ½Ð°", callback_data="view_schedule")])[m
[32m+[m[32m            reply_markup = InlineKeyboardMarkup(keyboard_rows)[m
             object_name = obj.name if obj else "ÐÐµÐ¸Ð·Ð²ÐµÑÑ‚Ð½Ñ‹Ð¹ Ð¾Ð±ÑŠÐµÐºÑ‚"[m
             [m
             # Ð­ÐºÑ€Ð°Ð½Ð¸Ñ€ÑƒÐµÐ¼ ÑÐ¿ÐµÑ†ÑÐ¸Ð¼Ð²Ð¾Ð»Ñ‹ Markdown[m
[36m@@ -466,32 +471,49 @@[m [masync def handle_cancel_reason_selection(update: Update, context: ContextTypes.D[m
     # Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÐ¼ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñƒ Ð¸Ð· callback_data[m
     reason = query.data.replace("cancel_reason_", "")[m
     shift_id = context.user_data.get('cancelling_shift_id')[m
[31m-    [m
[32m+[m
[32m+[m[32m    logger.info(f"Cancel reason selection: user={telegram_id}, reason={reason}, shift_id={shift_id}")[m
[32m+[m
     if not shift_id:[m
[32m+[m[32m        logger.error(f"No shift_id in context for user {telegram_id}")[m
         await query.edit_message_text("âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: ÑÐ¼ÐµÐ½Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð° Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ðµ.")[m
         return[m
[31m-    [m
[32m+[m
     # Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñƒ Ð² ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚[m
     context.user_data['cancel_reason'] = reason[m
[31m-    [m
[31m-    # Ð”Ð»Ñ ÑÐ¿Ñ€Ð°Ð²Ð¾Ðº Ð¸ "Ð”Ñ€ÑƒÐ³Ð°Ñ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ð°" Ð¿Ñ€Ð¾ÑÐ¸Ð¼ Ð²Ð²ÐµÑÑ‚Ð¸ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ/Ð¾Ð±ÑŠÑÑÐ½ÐµÐ½Ð¸Ðµ[m
[31m-    if reason in ['medical_cert', 'emergency_cert', 'police_cert']:[m
[31m-        reason_names = {[m
[31m-            'medical_cert': 'Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¾Ð¹ ÑÐ¿Ñ€Ð°Ð²ÐºÐ¸',[m
[31m-            'emergency_cert': 'ÑÐ¿Ñ€Ð°Ð²ÐºÐ¸ Ð¾Ñ‚ ÐœÐ§Ð¡',[m
[31m-            'police_cert': 'ÑÐ¿Ñ€Ð°Ð²ÐºÐ¸ Ð¾Ñ‚ Ð¿Ð¾Ð»Ð¸Ñ†Ð¸Ð¸'[m
[31m-        }[m
[31m-        [m
[32m+[m
[32m+[m[32m    # ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¿Ð¾Ð»Ð¸Ñ‚Ð¸ÐºÑƒ Ð´Ð»Ñ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ð° Ð¾Ð±ÑŠÐµÐºÑ‚Ð°[m
[32m+[m[32m    from core.database.session import get_async_session[m
[32m+[m[32m    async with get_async_session() as session:[m
[32m+[m[32m        shift_query = select(ShiftSchedule).where(ShiftSchedule.id == shift_id)[m
[32m+[m[32m        shift_result = await session.execute(shift_query)[m
[32m+[m[32m        shift = shift_result.scalar_one_or_none()[m
[32m+[m[32m        if not shift:[m
[32m+[m[32m            await query.edit_message_text("âŒ Ð¡Ð¼ÐµÐ½Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°.")[m
[32m+[m[32m            return[m
[32m+[m[32m        object_query = select(Object).where(Object.id == shift.object_id)[m
[32m+[m[32m        obj = (await session.execute(object_query)).scalar_one_or_none()[m
[32m+[m[32m        if not obj:[m
[32m+[m[32m            await query.edit_message_text("âŒ ÐžÐ±ÑŠÐµÐºÑ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½.")[m
[32m+[m[32m            return[m
[32m+[m[32m        from shared.services.cancellation_policy_service import CancellationPolicyService[m
[32m+[m[32m        reason_map = await CancellationPolicyService.get_reason_map(session, obj.owner_id)[m
[32m+[m[32m        policy = reason_map.get(reason)[m
[32m+[m[32m        requires_document = bool(policy and policy.requires_document)[m
[32m+[m
[32m+[m[32m    # Ð’ÐµÑ‚Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸ÑŽ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°[m
[32m+[m[32m    if requires_document:[m
         # Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÐ¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð¾Ð¶Ð¸Ð´Ð°Ð½Ð¸Ñ Ð²Ð²Ð¾Ð´Ð°[m
         from core.state.user_state_manager import user_state_manager, UserAction, UserStep[m
         user_state_manager.set_state([m
             telegram_id,[m
[31m-            action=UserAction.CANCEL_SHIFT,[m
[32m+[m[32m            action=UserAction.CANCEL_SCHEDULE,[m
             step=UserStep.INPUT_DOCUMENT[m
         )[m
[31m-        [m
[32m+[m
[32m+[m[32m        title = policy.title if policy else 'Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°'[m
         await query.edit_message_text([m
[31m-            f"ðŸ“„ **ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ {reason_names[reason]}**\n\n"[m
[32m+[m[32m            f"ðŸ“„ **ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ {title}**\n\n"[m
             f"Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð½Ð¾Ð¼ÐµÑ€ Ð¸ Ð´Ð°Ñ‚Ñƒ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°.\n"[m
             f"ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: `â„–123 Ð¾Ñ‚ 10.10.2025`\n\n"[m
             f"Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ° Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð° Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†ÐµÐ¼.",[m
[36m@@ -502,7 +524,7 @@[m [masync def handle_cancel_reason_selection(update: Update, context: ContextTypes.D[m
         from core.state.user_state_manager import user_state_manager, UserAction, UserStep[m
         user_state_manager.set_state([m
             telegram_id,[m
[31m-            action=UserAction.CANCEL_SHIFT,[m
[32m+[m[32m            action=UserAction.CANCEL_SCHEDULE,[m
             step=UserStep.INPUT_DOCUMENT[m
         )[m
         [m
[36m@@ -512,6 +534,29 @@[m [masync def handle_cancel_reason_selection(update: Update, context: ContextTypes.D[m
             "Ð’Ð°ÑˆÐµ Ð¾Ð±ÑŠÑÑÐ½ÐµÐ½Ð¸Ðµ Ð±ÑƒÐ´ÐµÑ‚ Ñ€Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€ÐµÐ½Ð¾ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†ÐµÐ¼.",[m
             parse_mode='Markdown'[m
         )[m
[32m+[m[32m    else:[m
[32m+[m[32m        # Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½ (Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‰Ð¸Ñ… Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚) ÑÑ€Ð°Ð·Ñƒ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÐ¼ Ð¾Ñ‚Ð¼ÐµÐ½Ñƒ[m
[32m+[m[32m        logger.info(f"Executing immediate cancellation for user {telegram_id}, reason={reason}, shift_id={shift_id}")[m
[32m+[m[32m        success = await _execute_shift_cancellation([m
[32m+[m[32m            shift_id=shift_id,[m
[32m+[m[32m            telegram_id=telegram_id,[m
[32m+[m[32m            reason=reason,[m
[32m+[m[32m            reason_notes=None,[m
[32m+[m[32m            document_description=None,[m
[32m+[m[32m            context=context,[m
[32m+[m[32m            query=query[m
[32m+[m[32m        )[m
[32m+[m[41m        [m
[32m+[m[32m        if success:[m
[32m+[m[32m            await query.edit_message_text([m
[32m+[m[32m                "âœ… Ð¡Ð¼ÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½Ð°!\n\n"[m
[32m+[m[32m                "ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ",[m
[32m+[m[32m                reply_markup=InlineKeyboardMarkup([[[m
[32m+[m[32m                    InlineKeyboardButton("ðŸ  Ð“Ð»Ð°Ð²Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ", callback_data="main_menu")[m
[32m+[m[32m                ]])[m
[32m+[m[32m            )[m
[32m+[m[32m        else:[m
[32m+[m[32m            await query.edit_message_text("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ðµ ÑÐ¼ÐµÐ½Ñ‹. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ.")[m
 [m
 [m
 async def handle_cancellation_document_input(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:[m
[36m@@ -519,6 +564,14 @@[m [masync def handle_cancellation_document_input(update: Update, context: ContextTyp[m
     telegram_id = update.effective_user.id[m
     description_text = update.message.text[m
     [m
[32m+[m[32m    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ[m
[32m+[m[32m    from core.state.user_state_manager import user_state_manager, UserAction, UserStep[m
[32m+[m[32m    user_state = await user_state_manager.get_state(telegram_id)[m
[32m+[m[41m    [m
[32m+[m[32m    if not user_state or user_state.action != UserAction.CANCEL_SCHEDULE or user_state.step != UserStep.INPUT_DOCUMENT:[m
[32m+[m[32m        # ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð² ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ð¸ Ð²Ð²Ð¾Ð´Ð° Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð° Ð´Ð»Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ - Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼[m
[32m+[m[32m        return[m
[32m+[m[41m    [m
     shift_id = context.user_data.get('cancelling_shift_id')[m
     reason = context.user_data.get('cancel_reason')[m
     [m
[36m@@ -569,7 +622,7 @@[m [masync def handle_cancellation_document_input(update: Update, context: ContextTyp[m
             from core.state.user_state_manager import user_state_manager, UserAction, UserStep[m
             user_state_manager.set_state([m
                 telegram_id,[m
[31m-                action=UserAction.CANCEL_SHIFT,[m
[32m+[m[32m                action=UserAction.CANCEL_SCHEDULE,[m
                 step=UserStep.INPUT_PHOTO[m
             )[m
             [m
[36m@@ -729,28 +782,37 @@[m [masync def _execute_shift_cancellation([m
     context: ContextTypes.DEFAULT_TYPE,[m
     query: Optional[Any] = None,[m
     message: Optional[Any] = None[m
[31m-) -> None:[m
[32m+[m[32m) -> bool:[m
     """Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð¼ÐµÐ½Ñƒ ÑÐ¼ÐµÐ½Ñ‹ Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ ÑÐµÑ€Ð²Ð¸ÑÐ°."""[m
[32m+[m[32m    logger.info(f"Starting shift cancellation: shift_id={shift_id}, telegram_id={telegram_id}, reason={reason}")[m
[32m+[m[41m    [m
     from core.database.session import get_async_session[m
     from shared.services.shift_cancellation_service import ShiftCancellationService[m
     [m
     try:[m
         async with get_async_session() as session:[m
[32m+[m[32m            logger.info(f"Got database session for cancellation")[m
[32m+[m[41m            [m
             # ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ[m
             user_query = select(User).where(User.telegram_id == telegram_id)[m
             user_result = await session.execute(user_query)[m
             user = user_result.scalar_one_or_none()[m
             [m
[32m+[m[32m            logger.info(f"Found user: {user.id if user else 'None'}")[m
[32m+[m[41m            [m
             if not user:[m
                 text = "âŒ ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½."[m
                 if query:[m
                     await query.edit_message_text(text)[m
                 elif message:[m
                     await message.reply_text(text)[m
[31m-                return[m
[32m+[m[32m                return False[m
             [m
             # Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ ÑÐµÑ€Ð²Ð¸Ñ Ð´Ð»Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹[m
[32m+[m[32m            logger.info(f"Creating ShiftCancellationService")[m
             cancellation_service = ShiftCancellationService(session)[m
[32m+[m[32m            logger.info(f"Calling cancel_shift with shift_schedule_id={shift_id}, cancelled_by_user_id={user.id}")[m
[32m+[m[41m            [m
             result = await cancellation_service.cancel_shift([m
                 shift_schedule_id=shift_id,[m
                 cancelled_by_user_id=user.id,[m
[36m@@ -800,6 +862,7 @@[m [masync def _execute_shift_cancellation([m
                     await message.reply_text(text, parse_mode='Markdown')[m
                 [m
                 # TODO: ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†Ñƒ/ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‰ÐµÐ¼Ñƒ[m
[32m+[m[32m                return True[m
                 [m
             else:[m
                 text = f"âŒ {result['message']}"[m
[36m@@ -807,14 +870,17 @@[m [masync def _execute_shift_cancellation([m
                     await query.edit_message_text(text)[m
                 elif message:[m
                     await message.reply_text(text)[m
[32m+[m[32m                return False[m
     [m
     except Exception as e:[m
[31m-        logger.error(f"Error executing shift cancellation: {e}")[m
[32m+[m[32m        logger.error(f"Error executing shift cancellation: {e}", exc_info=True)[m
[32m+[m[32m        logger.error(f"Exception details: type={type(e)}, args={e.args}")[m
         text = "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ ÑÐ¼ÐµÐ½Ñ‹. ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ð¾Ð·Ð¶Ðµ."[m
         if query:[m
             await query.edit_message_text(text)[m
         elif message:[m
             await message.reply_text(text)[m
[32m+[m[32m        return False[m
 [m
 [m
 async def handle_close_schedule(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:[m
