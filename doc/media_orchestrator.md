Предлагаемая стратегия хранения медиа
    • Общее правило: медиа должны жить отдельно от приложений и БД. Лучше сразу использовать объектное хранилище с версионированием и политиками доступа (S3-совместимое) — оно легко масштабируется и не зависит от локального диска контейнера.
    • S3-совместимое хранилище:
    • На dev можно поднять MinIO в Docker.
    • На prod выбрать управляемое решение (Yandex Object Storage, AWS S3, Selectel, VK Cloud).
    • Если доступ к внешним сервисам ограничен, рассмотреть self-hosted MinIO в выделенном контейнере/VM с резервным копированием.
    • Структура ключей: shift-cancellations/{owner_id}/{shift_id}/{uuid}.{ext}. Добавляем метаданные (mime-type, дата загрузки, роль).
Архитектура сервиса загрузки медиа
    1. Shared слой:
    • shared/services/media_storage_service.py — умеет загружать/получать/удалять объекты. Интерфейс не зависит от конкретного провайдера.
    • shared/services/media_orchestrator.py — уже используется задачами/инцидентами, расширяем его методами store_cancellation_proof, list_media, generate_presigned_url.
    2. Конфигурация:
    • Новый блок в .env / settings: MEDIA_STORAGE_PROVIDER, MEDIA_STORAGE_ENDPOINT, MEDIA_STORAGE_BUCKET, MEDIA_STORAGE_ACCESS_KEY, MEDIA_STORAGE_SECRET_KEY, MEDIA_STORAGE_REGION, MEDIA_STORAGE_PUBLIC_BASE_URL.
    • Разные значения для dev/prod (dev → локальный MinIO, prod → управляемый S3).
    3. Безопасность и доступ:
    • Хранить только приватные объекты, выдавать подписанные ссылки (presigned URLs) на ограниченное время.
    • Валидировать тип/размер файлов в бэкенде (например, только изображения/pdf до 10 MB).
    • Логи аудита: кто загрузил, какая смена, IP.
    4. Интеграция:
    • Shared-страница отмен (новый роут, например, apps/web/routes/shared/cancellations.py) использует Media Orchestrator для загрузки/отображения подтверждений.
    • Обновить модели: ShiftCancellation добавить ссылку/JSON на медиа.
    • API для удалённого просмотра в карточках смен (owner/manager).
    5. Масштабирование:
    • S3 позволяет отделить хранение от compute.
    • В будущем можно:
    • Вынести загрузку медиа в отдельный сервис (FastAPI + background workers).
    • Ставить CDN перед бакетом.
    • Настроить lifecycle-политику (архивация старых медиа).
    6. Резервирование и мониторинг:
    • Регулярные бэкапы бакета или cross-region replication.
    • Логи/метрики: количество объектов, объём, проценты заполнения.