# –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã: "–†–∞–Ω–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ" –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤

**–î–∞—Ç–∞:** 2025-11-01  
**–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –í—á–µ—Ä–∞ (1.11 –≤ 23:58) –¥–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–ª "–†–∞–Ω–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ 30 –º–∏–Ω, 26 –º–∏–Ω—É—Ç, 29" –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤, —Ö–æ—Ç—è –≤–∏–∑—É–∞–ª—å–Ω–æ –æ–±—ä–µ–∫—Ç—ã –∑–∞–∫—Ä—ã–ª–∏—Å—å –≤–æ –≤—Ä–µ–º—è +10 –º–∏–Ω—É—Ç –æ—Ç –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–∫—Ä—ã—Ç–∏—è. –°–µ–π—á–∞—Å (–Ω–æ–≤—ã–µ —Å—É—Ç–∫–∏) –¥–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—á–µ—Ä–∫ - —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

## üîç –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –ö–û–î–ê

### –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ —Ä–∞–Ω–Ω–µ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è

**–§–∞–π–ª:** `apps/web/routes/owner.py`  
**–°—Ç—Ä–æ–∫–∏:** 331-343

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è (–∫–∞–∫ –±—ã–ª–æ)
if last_shift.end_time and last_shift.status == 'completed' and not active_shifts_on_object:
    naive_expected_close = datetime.combine(today_local, obj.closing_time)
    expected_close = timezone_helper.local_tz.localize(naive_expected_close)
    actual_close_local = timezone_helper.utc_to_local(last_shift.end_time)
    early_minutes = int((expected_close - actual_close_local).total_seconds() / 60)
    if early_minutes > 5:
        work_status = 'early_closing'
        work_early = early_minutes
```

### –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê #1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã

**–°—Ç—Ä–æ–∫–∞ 334:**
```python
expected_close = timezone_helper.local_tz.localize(naive_expected_close)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `timezone_helper.local_tz` - —ç—Ç–æ `default_timezone` –∏–∑ `settings` ("Europe/Moscow"), **–ù–ï –≤—Ä–µ–º—è –æ–±—ä–µ–∫—Ç–∞!**

**–°—Ç—Ä–æ–∫–∞ 335:**
```python
actual_close_local = timezone_helper.utc_to_local(last_shift.end_time)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `timezone_helper.utc_to_local()` –±–µ–∑ –≤—Ç–æ—Ä–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `default_timezone` ("Europe/Moscow"), **–ù–ï –≤—Ä–µ–º—è –æ–±—ä–µ–∫—Ç–∞!**

### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –≤ –¥—Ä—É–≥–æ–º —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, UTC+5):**
   - `obj.closing_time` = 22:00 (–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—ä–µ–∫—Ç–∞, UTC+5)
   - `naive_expected_close` = 2025-11-01 22:00 (naive datetime)
   - `expected_close` = 2025-11-01 22:00 MSK (UTC+3) ‚Üê **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å UTC+5!
   - `last_shift.end_time` = 2025-11-01 19:00 UTC (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤ UTC+5 = 00:00+1 –¥–µ–Ω—å)
   - `actual_close_local` = 2025-11-01 22:00 MSK (UTC+3) ‚Üê **–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!** –î–æ–ª–∂–Ω–æ –±—ã—Ç—å UTC+5!
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏–¥—ë—Ç –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω–µ!

2. **–ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –≤ MSK (UTC+3):**
   - `obj.closing_time` = 22:00 (–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ–±—ä–µ–∫—Ç–∞, UTC+3)
   - `naive_expected_close` = 2025-11-01 22:00 (naive datetime)
   - `expected_close` = 2025-11-01 22:00 MSK (UTC+3) ‚úÖ
   - `last_shift.end_time` = 2025-11-01 19:00 UTC (—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤ MSK = 22:00)
   - `actual_close_local` = 2025-11-01 22:00 MSK (UTC+3) ‚úÖ
   - **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –≤—Ä–µ–º—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç - –≤—Å—ë –æ–∫

### –°–¶–ï–ù–ê–†–ò–ô –í–û–ó–ù–ò–ö–ù–û–í–ï–ù–ò–Ø –ë–ê–ì–ê:

**–î–∞—Ç–∞:** 1.11.2025, –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: 23:58 MSK (UTC+3)

**–û–±—ä–µ–∫—Ç 1:**
- `obj.closing_time` = 22:00
- `obj.timezone` = "Europe/Moscow" (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º)
- –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ: 22:10 MSK (–≤—Ä–µ–º—è +10 –º–∏–Ω—É—Ç –æ—Ç –∑–∞–∫—Ä—ã—Ç–∏—è)

**–†–∞—Å—á—ë—Ç:**
1. `naive_expected_close` = `datetime.combine(2025-11-01, 22:00)` = `2025-11-01 22:00` (naive)
2. `expected_close` = `timezone_helper.local_tz.localize(2025-11-01 22:00)` = `2025-11-01 22:00+03:00` (MSK)
3. `last_shift.end_time` –≤ –ë–î (UTC): `2025-11-01 19:10 UTC` (22:10 MSK = 19:10 UTC)
4. `actual_close_local` = `timezone_helper.utc_to_local(2025-11-01 19:10 UTC)` = `2025-11-01 22:10+03:00` (MSK) ‚úÖ
5. `early_minutes` = `(2025-11-01 22:00+03:00 - 2025-11-01 22:10+03:00)` = `-10 –º–∏–Ω—É—Ç` ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `actual_close_local` > `expected_close`, —Ç–æ `early_minutes` –±—É–¥–µ—Ç **–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º**!

### –ê–ù–ê–õ–ò–ó –õ–û–ì–ò–ö–ò:

**–°—Ç—Ä–æ–∫–∞ 336:**
```python
early_minutes = int((expected_close - actual_close_local).total_seconds() / 60)
```

**–§–æ—Ä–º—É–ª–∞:** `expected_close - actual_close_local`

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- –ï—Å–ª–∏ `early_minutes > 0` ‚Üí –æ–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è **—Ä–∞–Ω—å—à–µ** –æ–∂–∏–¥–∞–µ–º–æ–≥–æ
- –ï—Å–ª–∏ `early_minutes < 0` ‚Üí –æ–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è **–ø–æ–∑–∂–µ** –æ–∂–∏–¥–∞–µ–º–æ–≥–æ
- –ï—Å–ª–∏ `early_minutes == 0` ‚Üí –æ–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è **–≤–æ–≤—Ä–µ–º—è**

**–ù–û:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç—ã –∑–∞–∫—Ä—ã–ª–∏—Å—å **–ø–æ–∑–∂–µ** (+10 –º–∏–Ω—É—Ç), –Ω–æ –¥–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **"–†–∞–Ω–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ"**!

### –ì–ò–ü–û–¢–ï–ó–ê #1: –ò–Ω–≤–µ—Ä—Å–∏—è –∑–Ω–∞–∫–∞

**–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –õ–æ–≥–∏–∫–∞ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞?

–ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è –≤ 22:10, –∞ –æ–∂–∏–¥–∞–ª–æ—Å—å 22:00:
- `expected_close` = 22:00
- `actual_close_local` = 22:10
- `early_minutes = (22:00 - 22:10) = -10 –º–∏–Ω—É—Ç`

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è:**
```python
if early_minutes > 5:  # -10 > 5? –ù–ï–¢
```

**–í—ã–≤–æ–¥:** –ï—Å–ª–∏ `early_minutes` –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π, —É—Å–ª–æ–≤–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç. –ó–Ω–∞—á–∏—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ –≤ –∏–Ω–≤–µ—Ä—Å–∏–∏.

### –ì–ò–ü–û–¢–ï–ó–ê #2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `timezone_helper.local_tz` (MSK) –≤–º–µ—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—ä–µ–∫—Ç–∞.

**–ü—Ä–∏–º–µ—Ä –¥–ª—è –æ–±—ä–µ–∫—Ç–∞ –≤ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–µ (UTC+5):**
1. `obj.closing_time` = 22:00 (–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–∞)
2. `naive_expected_close` = `2025-11-01 22:00` (naive)
3. `expected_close` = `timezone_helper.local_tz.localize(2025-11-01 22:00)` = `2025-11-01 22:00 MSK` (UTC+3) ‚ùå
4. **–ù–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:** `2025-11-01 22:00 –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥` (UTC+5)

**–ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è –≤ 22:10 (–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥):**
- –í UTC: `2025-11-01 17:10 UTC` (22:10 - 5 —á–∞—Å–æ–≤)
- –í MSK: `2025-11-01 20:10 MSK` (17:10 + 3 —á–∞—Å–∞)
- `actual_close_local` = `2025-11-01 20:10 MSK` (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ `utc_to_local`)

**–°—Ä–∞–≤–Ω–µ–Ω–∏–µ:**
- `expected_close` = `2025-11-01 22:00 MSK` (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 22:00 –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥)
- `actual_close_local` = `2025-11-01 20:10 MSK` (–ü–†–ê–í–ò–õ–¨–ù–û –¥–ª—è MSK, –Ω–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ)
- `early_minutes = (22:00 MSK - 20:10 MSK) = 110 –º–∏–Ω—É—Ç` ‚ùå

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–†–∞–Ω–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ 110 –º–∏–Ω" –≤–º–µ—Å—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞!

### –ì–ò–ü–û–¢–ï–ó–ê #3: –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º `last_shift`

**–°—Ç—Ä–æ–∫–∞ 287:**
```python
last_shift = max(shifts_today, key=lambda s: s.end_time or s.start_time)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `s.end_time` = `None`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `s.start_time`. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –≤—ã–±–æ—Ä—É –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–º–µ–Ω—ã.

**–¢–∞–∫–∂–µ:** –ï—Å–ª–∏ —Å–º–µ–Ω –Ω–µ—Å–∫–æ–ª—å–∫–æ, –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–º–µ–Ω–∞ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º `end_time`. –ù–æ –µ—Å–ª–∏ –æ–¥–Ω–∞ —Å–º–µ–Ω–∞ –∑–∞–∫—Ä—ã–ª–∞—Å—å –≤ 21:00, –∞ –¥—Ä—É–≥–∞—è –≤ 22:10, —Ç–æ `last_shift` –±—É–¥–µ—Ç —Å–º–µ–Ω–∞ —Å `end_time = 22:10`.

### –ì–ò–ü–û–¢–ï–ó–ê #4: –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π —Å–º–µ–Ω

**–°—Ç—Ä–æ–∫–∏ 179-207:** –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–º–µ–Ω –ø–æ `planned_start` –∏–ª–∏ `start_time/actual_start` –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ `start_of_day_utc` - `end_of_day_utc`.

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ —Å–º–µ–Ω–∞ –∑–∞–∫—Ä—ã–ª–∞—Å—å –≤ 22:10 MSK (1.11), –Ω–æ –Ω–∞—á–∞–ª–∞—Å—å –≤ 23:00 MSK (1.11) –∏–ª–∏ –≤ 00:00 MSK (2.11), —Ç–æ –æ–Ω–∞ –º–æ–∂–µ—Ç –Ω–µ –ø–æ–ø–∞—Å—Ç—å –≤ `shifts_today`.

**–ù–û:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –¥–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å, –∑–Ω–∞—á–∏—Ç —Å–º–µ–Ω—ã –Ω–∞–π–¥–µ–Ω—ã.

### –ì–ò–ü–û–¢–ï–ó–ê #5: –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º `closing_time` –æ–±—ä–µ–∫—Ç–∞

**–°—Ç—Ä–æ–∫–∞ 333:**
```python
naive_expected_close = datetime.combine(today_local, obj.closing_time)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `today_local` (–¥–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞) –≤–º–µ—Å—Ç–æ –¥–∞—Ç—ã –∑–∞–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã.

**–ù–û:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `today_local` –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥—Ä—É–≥–æ–º.

## üîé –ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –ê–ù–ê–õ–ò–ó –§–û–†–ú–£–õ–´:

**–°—Ç—Ä–æ–∫–∞ 336:**
```python
early_minutes = int((expected_close - actual_close_local).total_seconds() / 60)
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º—É–ª—ã:**
- `expected_close - actual_close_local` = —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –æ–∂–∏–¥–∞–µ–º—ã–º –∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º
- –ï—Å–ª–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è ‚Üí –æ–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è —Ä–∞–Ω—å—à–µ
- –ï—Å–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è ‚Üí –æ–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è –ø–æ–∑–∂–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è **–ø–æ–∑–∂–µ** –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏:
- `actual_close_local` > `expected_close`
- `early_minutes` < 0
- –£—Å–ª–æ–≤–∏–µ `if early_minutes > 5:` **–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç**

**–ù–û:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç "–†–∞–Ω–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ 30 –º–∏–Ω" –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–∫—Ä—ã–ª–∏—Å—å **–ø–æ–∑–∂–µ**!

### –í–û–ó–ú–û–ñ–ù–û–ï –û–ë–™–Ø–°–ù–ï–ù–ò–ï:

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –û–±—ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–∫—Ä—ã—Ç—å—Å—è –≤ 22:00, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–ª—Å—è –≤ 21:30 (–Ω–∞ 30 –º–∏–Ω—É—Ç —Ä–∞–Ω—å—à–µ).

**–†–∞—Å—á—ë—Ç:**
1. `expected_close` = `2025-11-01 22:00 MSK`
2. `actual_close_local` = `2025-11-01 21:30 MSK` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ –≤—Ä–µ–º—è –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏)
3. `early_minutes = (22:00 - 21:30) = 30 –º–∏–Ω—É—Ç` ‚úÖ
4. `if early_minutes > 5:` ‚Üí **–î–ê** ‚Üí —Å—Ç–∞—Ç—É—Å "–†–∞–Ω–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ 30 –º–∏–Ω"

**–ù–û:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ –≤–∏–∑—É–∞–ª—å–Ω–æ –æ–±—ä–µ–∫—Ç—ã –∑–∞–∫—Ä—ã–ª–∏—Å—å **–ø–æ–∑–∂–µ** (+10 –º–∏–Ω—É—Ç), –∞ –Ω–µ —Ä–∞–Ω—å—à–µ!

### –ü–†–û–ë–õ–ï–ú–ê –° –ö–û–ù–í–ï–†–¢–ê–¶–ò–ï–ô –í–†–ï–ú–ï–ù–ò:

**–ö–ª—é—á–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `timezone_helper.local_tz` (MSK) –≤–º–µ—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—ä–µ–∫—Ç–∞.

**–ü—Ä–∏–º–µ—Ä:**
- –û–±—ä–µ–∫—Ç –≤ –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥–µ (UTC+5): `obj.closing_time` = 22:00
- –û–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤ 22:10 (–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥)

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç:**
1. `expected_close` = `2025-11-01 22:00 MSK` (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û! –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 22:00 –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥)
2. `actual_close_local` = `2025-11-01 17:10 UTC ‚Üí 20:10 MSK` (–∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è —á–µ—Ä–µ–∑ MSK)
3. `early_minutes = (22:00 MSK - 20:10 MSK) = 110 –º–∏–Ω—É—Ç` ‚ùå

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç:**
1. `expected_close` = `2025-11-01 22:00 –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥` (UTC+5)
2. `actual_close_local` = `2025-11-01 22:10 –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥` (UTC+5)
3. `early_minutes = (22:00 - 22:10) = -10 –º–∏–Ω—É—Ç` (–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∂–µ)

## üìä –í–´–í–û–î

**–ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `timezone_helper.local_tz` (MSK) –≤–º–µ—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—ä–µ–∫—Ç–∞ (`obj.timezone`) –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ `expected_close` –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ `actual_close_local`.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –î–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ –¥—Ä—É–≥–∏—Ö —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–∞—Ö (–Ω–µ MSK) —Ä–∞—Å—á—ë—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
- –î–∞—à–±–æ—Ä–¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–†–∞–Ω–Ω–µ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ" –¥–∞–∂–µ –µ—Å–ª–∏ –æ–±—ä–µ–∫—Ç –∑–∞–∫—Ä—ã–ª—Å—è –≤–æ–≤—Ä–µ–º—è –∏–ª–∏ –ø–æ–∑–∂–µ
- –ó–Ω–∞—á–µ–Ω–∏–µ –º–∏–Ω—É—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–∑-–∑–∞ —Ä–∞–∑–Ω–∏—Ü—ã —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `obj.timezone` –≤–º–µ—Å—Ç–æ `timezone_helper.local_tz` –¥–ª—è:
1. –†–∞—Å—á—ë—Ç–∞ `expected_close`
2. –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ `actual_close_local`

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–†–û–ë–õ–ï–ú–ê –ò–î–ï–ù–¢–ò–§–ò–¶–ò–†–û–í–ê–ù–ê**





