# –ü–ª–∞–Ω —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏: Rules Engine + Tasks v2 + Incidents

**–¶–µ–ª—å**: –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∞–≤—Ç–æ–ø—Ä–∞–≤–∏–ª, –∑–∞–¥–∞—á v2 –∏ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ `.plan.md`

**–°—Ç–∞—Ç—É—Å**: –í –ø—Ä–æ—Ü–µ—Å—Å–µ (70% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

---

## 1. –ó–∞–¥–∞—á–∏ v2 ‚Äî –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### 1.1 –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á (`/owner/tasks/templates`)
- [x] CRUD —à–∞–±–ª–æ–Ω–æ–≤
- [x] –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞
- [x] Toggle –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å –º–æ–¥–∞–ª–∫–æ–π "–æ–±–Ω–æ–≤–∏—Ç—å –ø–ª–∞–Ω—ã"
- [x] –£–¥–∞–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —Å –≤—ã–±–æ—Ä–æ–º: —É–¥–∞–ª–∏—Ç—å/–æ—Ç–≤—è–∑–∞—Ç—å –∑–∞–¥–∞—á–∏
- [x] –§–∏–ª—å—Ç—Ä "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ" (—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç)
- [x] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ (–º–æ–¥–∞–ª–∫–∞)
- [ ] **Smoke-—Ç–µ—Å—Ç**: —Å–æ–∑–¥–∞—Ç—å/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/–¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω

### 1.2 –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á (`/owner/tasks/plan`)
- [x] –í—ã–±–æ—Ä "–ø–æ —à–∞–±–ª–æ–Ω—É" / "–±–µ–∑ —à–∞–±–ª–æ–Ω–∞"
- [x] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª–µ–π –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —à–∞–±–ª–æ–Ω–∞ (—Å–µ—Ä—ã–µ, –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)
- [x] –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–æ–≤ (—á–µ–∫–±–æ–∫—Å—ã)
- [x] –ü–æ–ª–µ "–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞" (–æ–ø—Ü.) —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –ø—Ä–æ —Ç–∞–π–º-—Å–ª–æ—Ç—ã
- [x] –¶–∏–∫–ª–∏—á–Ω–æ—Å—Ç—å: Weekdays / Day Interval
- [x] –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ: "Object A –∏ –µ—â—ë 5", —Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö
- [x] –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ (–º–æ–¥–∞–ª–∫–∞)
- [ ] **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞** –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∞
- [ ] **Smoke-—Ç–µ—Å—Ç**: —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω (–º—É–ª—å—Ç–∏-–æ–±—ä–µ–∫—Ç—ã, –ø–æ–≤—Ç–æ—Ä) ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å TaskEntryV2 –≤ –ë–î
- [ ] **Edge-–∫–µ–π—Å—ã**: –ø–æ–≤—Ç–æ—Ä –±–µ–∑ –∫–æ–Ω—Ü–∞, weekdays –±–µ–∑ –≤—ã–±–æ—Ä–∞ –¥–Ω–µ–π, –ø—É—Å—Ç–æ–µ –≤—Ä–µ–º—è

### 1.3 –ê—É–¥–∏—Ç –∑–∞–¥–∞—á (`/owner/tasks/entries`)
- [x] –¢–∞–±–ª–∏—Ü–∞ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ (–¥–∞—Ç–∞, –æ–±—ä–µ–∫—Ç, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, —Å—Ç–∞—Ç—É—Å)
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ: —à–∞–±–ª–æ–Ω, –æ–±—ä–µ–∫—Ç, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, —Å—Ç–∞—Ç—É—Å
- [x] –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π" –¥–ª—è –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö
- [ ] **Smoke-—Ç–µ—Å—Ç**: –æ—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã, –æ—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É

---

## 2. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ Celery

### 2.1 –ù–æ—á–Ω–æ–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (04:00 MSK)
- [x] Celery Beat task `auto_assign_tasks_celery`
- [x] –°–æ–∑–¥–∞–Ω–∏–µ TaskEntryV2 –¥–ª—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–º–µ–Ω
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è**: `docker compose logs celery-beat | grep auto-assign`
- [ ] **–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–≥–æ–Ω**: —Å–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω –Ω–∞ –∑–∞–≤—Ç—Ä–∞ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å entries —É—Ç—Ä–æ–º

### 2.2 –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- [x] –í—ã–∑–æ–≤ `create_task_entries_for_shift` –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –º—É–ª—å—Ç–∏-–æ–±—ä–µ–∫—Ç–æ–≤ (`object_ids`)
- [ ] **Smoke-—Ç–µ—Å—Ç**: –æ—Ç–∫—Ä—ã—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–º–µ–Ω—É ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å TaskEntryV2
- [ ] **Smoke-—Ç–µ—Å—Ç**: –æ—Ç–∫—Ä—ã—Ç—å —Å–ø–æ–Ω—Ç–∞–Ω–Ω—É—é —Å–º–µ–Ω—É ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –ø–ª–∞–Ω–∞–º –æ–±—ä–µ–∫—Ç–∞

---

## 3. –ë–æ—Ç ‚Äî Tasks v2

### 3.1 "–ú–æ–∏ –∑–∞–¥–∞—á–∏" (–ø—Ä–æ—Å–º–æ—Ç—Ä)
- [x] –ó–∞–≥—Ä—É–∑–∫–∞ TaskEntryV2 —á–µ—Ä–µ–∑ `task_service.get_entries_for_shift()`
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ (‚úÖ/‚è≥/‚ùå)
- [x] –ö–Ω–æ–ø–∫–∞ "–û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π" –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –æ—Ç–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É ‚Üí "–ú–æ–∏ –∑–∞–¥–∞—á–∏" ‚Üí —Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
- [ ] **Edge-–∫–µ–π—Å**: —Å–º–µ–Ω–∞ –±–µ–∑ –∑–∞–¥–∞—á ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ—Ç –∑–∞–¥–∞—á"

### 3.2 –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ (—Å –º–µ–¥–∏–∞)
- [x] Callback `complete_task_v2:{entry_id}`
- [x] MediaOrchestrator –¥–ª—è —Ñ–æ—Ç–æ-–æ—Ç—á—ë—Ç–∞
- [x] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ TaskEntryV2 (completed_at, completion_media)
- [x] –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram —Ä–µ–ø–æ—Ä—Ç-–≥—Ä—É–ø–ø—É
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –æ—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î –∏ —Ä–µ–ø–æ—Ä—Ç-–≥—Ä—É–ø–ø–µ
- [ ] **Edge-–∫–µ–π—Å**: –æ—Ç–º–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞**: –¥—É–±–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å–ª–µ –º–µ–¥–∏–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 3.3 –°–ø–æ–Ω—Ç–∞–Ω–Ω—ã–µ —Å–º–µ–Ω—ã
- [x] –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ –∞–∫—Ç–∏–≤–Ω—ã–º –ø–ª–∞–Ω–∞–º –æ–±—ä–µ–∫—Ç–∞
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –æ—Ç–∫—Ä—ã—Ç—å –æ–±—ä–µ–∫—Ç –±–µ–∑ —Ç–∞–π–º-—Å–ª–æ—Ç–∞ ‚Üí "–ú–æ–∏ –∑–∞–¥–∞—á–∏" ‚Üí –∑–∞–¥–∞—á–∏ –ø–æ—è–≤–∏–ª–∏—Å—å
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞**: "üìù –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–º–µ–Ω—É: ‚Äî" –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ "–û–±—ä–µ–∫—Ç –æ—Ç–∫—Ä—ã—Ç!" ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 3.4 –ö–Ω–æ–ø–∫–∞ "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–º–µ–Ω—ã ‚Üí "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é" ‚Üí —Ä–µ–∞–∫—Ü–∏—è –µ—Å—Ç—å
- [ ] **–ü—Ä–æ–±–ª–µ–º–∞**: –Ω–µ–æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –ø–æ—Å–ª–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–º–µ–Ω—ã ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

---

## 4. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π (Payroll)

### 4.1 –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/owner/payroll/adjustments`
- [x] –ü–µ—Ä–µ–Ω–æ—Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —Å `/owner/payroll-adjustments`
- [x] –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏"
- [x] –ú–æ–¥–∞–ª–∫–∞ —Å –≤—ã–±–æ—Ä–æ–º: shift_base, task_bonus/penalty, late_start, cancellation_fine
- [x] AJAX —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –Ω–∞–∂–∞—Ç—å "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å" ‚Üí –º–æ–¥–∞–ª–∫–∞ ‚Üí —Å–æ–∑–¥–∞—Ç—å ‚Üí toast-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: Tasks v1 + v2 –æ—Ö–≤–∞—á–µ–Ω—ã

### 4.2 –ò—Å—Ç–æ—Ä–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] –ö–Ω–æ–ø–∫–∏ "–ò–∑–º–µ–Ω–∏—Ç—å" / "–ò—Å—Ç–æ—Ä–∏—è" –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
- [x] AJAX –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL –Ω–∞ `/owner/payroll/adjustments/{id}/*`
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –æ—Ç–∫—Ä—ã—Ç—å –∏—Å—Ç–æ—Ä–∏—é ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 4.3 –§–∏–ª—å—Ç—Ä—ã –∏ –¥–∞—Ç—ã
- [x] –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ timezone (MSK ‚Üí UTC) –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- [x] –§–∏–ª—å—Ç—Ä –ø–æ employee (–≤—Å–µ –∫–æ–≥–¥–∞-–ª–∏–±–æ —Ä–∞–±–æ—Ç–∞–≤—à–∏–µ) OR object (–≤–ª–∞–¥–µ–ª—å—Ü–∞)
- [ ] **Smoke-—Ç–µ—Å—Ç**: –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã (–¥–∞—Ç–∞, —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, –æ–±—ä–µ–∫—Ç, —Ç–∏–ø) ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### 4.4 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
- [x] Celery task `process_task_bonuses` (–∫–∞–∂–¥—ã–µ 10 –º–∏–Ω)
- [x] –°–æ–∑–¥–∞–Ω–∏–µ PayrollAdjustment –¥–ª—è TaskEntryV2
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**: `docker compose logs celery-worker | grep process_task_bonuses`
- [ ] **Smoke-—Ç–µ—Å—Ç**: –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É ‚Üí –ø–æ–¥–æ–∂–¥–∞—Ç—å 10 –º–∏–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫—É –≤ –ë–î
- [ ] **Edge-–∫–µ–π—Å**: –∑–∞–¥–∞—á–∞ –±–µ–∑ –ø—Ä–µ–º–∏–∏ (default_bonus_amount = 0)

---

## 5. Rules Engine (–ê–≤—Ç–æ–ø—Ä–∞–≤–∏–ª–∞)

### 5.1 –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/owner/rules`
- [x] –°–ø–∏—Å–æ–∫ –ø—Ä–∞–≤–∏–ª —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
- [x] –°–∫—Ä—ã—Ç–∏–µ –∫–æ–ª–æ–Ω–æ–∫ ID, Scope, Code, Priority
- [x] –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π: –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –û–ø–∏—Å–∞–Ω–∏–µ, –ê–∫—Ç–∏–≤–Ω–æ, –î–µ–π—Å—Ç–≤–∏–µ
- [x] –ö–Ω–æ–ø–∫–∏ –≤–∫–ª—é—á–µ–Ω–∏—è/–æ—Ç–∫–ª—é—á–µ–Ω–∏—è
- [x] –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ —Ñ–∏—á–∏ `rules_engine`
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –≤–∫–ª—é—á–∏—Ç—å —Ñ–∏—á—É ‚Üí –ø—Ä–∞–≤–∏–ª–∞ –ø–æ—è–≤–∏–ª–∏—Å—å
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –æ—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î

### 5.2 –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≤ –±–æ—Ç–µ
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `shift_cancellation_service.py`
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `adjustment_tasks.py` (–æ–ø–æ–∑–¥–∞–Ω–∏—è)
- [ ] **Smoke-—Ç–µ—Å—Ç (–æ–ø–æ–∑–¥–∞–Ω–∏–µ)**: –æ—Ç–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É —Å –æ–ø–æ–∑–¥–∞–Ω–∏–µ–º >10 –º–∏–Ω ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —à—Ç—Ä–∞—Ñ
- [ ] **Smoke-—Ç–µ—Å—Ç (–æ—Ç–º–µ–Ω–∞ <24—á)**: –æ—Ç–º–µ–Ω–∏—Ç—å —Å–º–µ–Ω—É –∑–∞ 12 —á–∞—Å–æ–≤ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —à—Ç—Ä–∞—Ñ 500‚ÇΩ
- [ ] **Smoke-—Ç–µ—Å—Ç (–Ω–µ—É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞)**: –æ—Ç–º–µ–Ω–∏—Ç—å —Å "–Ω–µ —Ö–æ—á—É" ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —à—Ç—Ä–∞—Ñ 1000‚ÇΩ
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**: –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–æ ‚Üí —à—Ç—Ä–∞—Ñ –Ω–µ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è

### 5.3 –ê–≤—Ç–æ—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞–º–∏
- [x] Hook `_handle_rules_engine_toggle` –≤ `owner_features.py`
- [x] –°–æ–∑–¥–∞–Ω–∏–µ/–∞–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª –ø—Ä–∏ toggle —Ñ–∏—á–∏
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –æ—Ç–∫–ª—é—á–∏—Ç—å —Ñ–∏—á—É ‚Üí –ø—Ä–∞–≤–∏–ª–∞ —Å—Ç–∞–ª–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –≤–∫–ª—é—á–∏—Ç—å —Ñ–∏—á—É ‚Üí –ø—Ä–∞–≤–∏–ª–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏—Å—å

---

## 6. Feature Flags –∏ –º–µ–Ω—é

### 6.1 –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ñ–∏—á
- [x] `contract_templates` ‚Üí `payroll` (depends_on)
- [x] –ê–≤—Ç–æ–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º—ã—Ö —Ñ–∏—á
- [x] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `disabled_dependent_features`
- [x] UI —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —á–µ–∫–±–æ–∫—Å—ã –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- [ ] **Smoke-—Ç–µ—Å—Ç**: –æ—Ç–∫–ª—é—á–∏—Ç—å "–®—Ç–∞—Ç–Ω–æ–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ..." ‚Üí "–®–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤" –æ—Ç–∫–ª—é—á–∏–ª–∏—Å—å

### 6.2 –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –º–µ–Ω—é
- [x] AJAX toggle —Ñ–∏—á –±–µ–∑ reload
- [x] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ sidebar —á–µ—Ä–µ–∑ `updateSidebarMenu()`
- [x] –†–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è event listeners (`ownerSidebar.attachEventListeners()`)
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ñ–∏—á—É ‚Üí –º–µ–Ω—é –æ–±–Ω–æ–≤–∏–ª–æ—Å—å ‚Üí –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è

### 6.3 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é
- [x] "–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ" ‚Üí –ö–∞–ª–µ–Ω–¥–∞—Ä—å, –°–º–µ–Ω—ã, –¢–∞–π–º-—Å–ª–æ—Ç—ã
- [x] "–ó–∞—Ä–ø–ª–∞—Ç–∞" ‚Üí –í—ã–ø–ª–∞—Ç—ã, –ù–∞—á–∏—Å–ª–µ–Ω–∏—è, –ü–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è, –®–∞–±–ª–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–æ–≤
- [x] "–®—Ç—Ä–∞—Ñ—ã –∏ –ø—Ä–µ–º–∏–∏" ‚Üí –ü—Ä–∞–≤–∏–ª–∞, –ú–æ–¥–µ—Ä–∞—Ü–∏—è, –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
- [x] "–ó–∞–¥–∞—á–∏" ‚Üí –®–∞–±–ª–æ–Ω—ã, –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ê—É–¥–∏—Ç
- [x] "–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã"
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –≤—Å–µ –ø—É–Ω–∫—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –∏ –≤–µ–¥—É—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

## 7. Media Orchestrator

### 7.1 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Tasks v2
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ-–æ—Ç—á—ë—Ç–æ–≤ —á–µ—Ä–µ–∑ `MediaOrchestrator`
- [x] State management —á–µ—Ä–µ–∑ Redis
- [ ] **Edge-–∫–µ–π—Å—ã**: max_photos (3), –æ—Ç–º–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∏, —Ç–∞–π–º–∞—É—Ç
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –∑–∞–≥—Ä—É–∑–∏—Ç—å 3 —Ñ–æ—Ç–æ ‚Üí –ø–æ–ø—ã—Ç–∫–∞ 4-–≥–æ ‚Üí –æ—à–∏–±–∫–∞

### 7.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –æ—Ç–º–µ–Ω—ã —Å–º–µ–Ω
- [x] –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ (–≤–µ–±/–±–æ—Ç)
- [ ] **Smoke-—Ç–µ—Å—Ç**: –æ—Ç–º–µ–Ω–∏—Ç—å —Å–º–µ–Ω—É ‚Üí –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î

---

## 8. –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã

### 8.1 –ë–∞–∑–æ–≤—ã–π CRUD
- [x] –ú–æ–¥–µ–ª—å `Incident` —Å –ø–æ–ª—è–º–∏ (category, severity, status, evidence_media)
- [x] –°–µ—Ä–≤–∏—Å `incident_service.py`
- [x] –°—Ç—Ä–∞–Ω–∏—Ü–∞ `/owner/incidents`
- [ ] **Smoke-—Ç–µ—Å—Ç**: —Å–æ–∑–¥–∞—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç ‚Üí –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î

### 8.2 –°–≤—è–∑—å —Å –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞–º–∏
- [x] –ü–æ–ª–µ `suggested_adjustments` (JSON)
- [ ] **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ø—Ä–∞–≤–∏–ª–æ —Å–æ–∑–¥–∞—ë—Ç –∏–Ω—Ü–∏–¥–µ–Ω—Ç ‚Üí —á–µ—Ä–Ω–æ–≤–∏–∫ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏
- [ ] **Smoke-—Ç–µ—Å—Ç**: –ø—Ä–∞–≤–∏–ª–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ ‚Üí –∏–Ω—Ü–∏–¥–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω ‚Üí –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞

---

## 9. –¢–µ—Å—Ç—ã –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### 9.1 Unit/Integration —Ç–µ—Å—Ç—ã
- [ ] Rules Engine: —É—Å–ª–æ–≤–∏—è –∏ –¥–µ–π—Å—Ç–≤–∏—è (late, cancellation, task)
- [ ] TaskService: CRUD —à–∞–±–ª–æ–Ω–æ–≤/–ø–ª–∞–Ω–æ–≤/entries
- [ ] MediaOrchestrator: —Å–æ—Å—Ç–æ—è–Ω–∏—è (text, photo, skip)
- [ ] Payroll: —Å–æ–∑–¥–∞–Ω–∏–µ adjustments —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª–∞
- [ ] –ë–æ—Ç: callback-–æ–±—Ä–∞–±–æ—Ç–∫–∞ Tasks v2

### 9.2 –ú–∏–≥—Ä–∞—Ü–∏–∏
- [x] –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (TaskPlanV2, TaskEntryV2, Rule, Incident)
- [x] –ß–∏—Å—Ç–∫–∞ –¥—É–±–ª–µ–π (merge heads)
- [ ] **–ü—Ä–æ–≤–µ—Ä–∫–∞**: `alembic heads` ‚Üí –æ–¥–∏–Ω head

---

## 10. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 10.1 Vision –∏ roadmap
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `doc/vision_v1/*` (–Ω–æ–≤—ã–µ —Ñ–∏—á–∏, –º–µ–Ω—é)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `doc/plans/roadmap.md` (–ø—Ä–æ–≥—Ä–µ—Å—Å –∏—Ç–µ—Ä–∞—Ü–∏–π)
- [ ] –î–æ–ø–æ–ª–Ω–∏—Ç—å `doc/DOCUMENTATION_RULES.md` (Tasks v2 API)

### 10.2 Developer guide
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∞–≤–∏–ª
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å MediaOrchestrator API
- [ ] –û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É Feature Flags

---

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –±–∞–≥–∏ (1-2 –¥–Ω—è)
1. [ ] "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é" –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ—Å–ª–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–º–µ–Ω—ã
2. [ ] –î—É–±–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ—Å–ª–µ —Ñ–æ—Ç–æ-–æ—Ç—á—ë—Ç–∞
3. [ ] "üìù –ó–∞–¥–∞—á–∏ –Ω–∞ —Å–º–µ–Ω—É: ‚Äî" –≤ —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã—Ö —Å–º–µ–Ω–∞—Ö (–¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–¥–∞—á–∏)
4. [ ] –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ø—Ä–∏ CRUD –ø–ª–∞–Ω–∞

### –§–∞–∑–∞ 2: Smoke-—Ç–µ—Å—Ç—ã –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ (2-3 –¥–Ω—è)
1. [ ] **E2E-—Ç–µ—Å—Ç (–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–º–µ–Ω–∞)**:
   - –°–æ–∑–¥–∞—Ç—å –ø–ª–∞–Ω (–º—É–ª—å—Ç–∏-–æ–±—ä–µ–∫—Ç—ã, –ø–æ–≤—Ç–æ—Ä)
   - –û—Ç–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É –ø–æ —Ç–∞–π–º-—Å–ª–æ—Ç—É
   - "–ú–æ–∏ –∑–∞–¥–∞—á–∏" ‚Üí –æ—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É —Å —Ñ–æ—Ç–æ
   - –ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: TaskEntryV2, PayrollAdjustment (shift_base, task_bonus, late_penalty)

2. [ ] **E2E-—Ç–µ—Å—Ç (—Å–ø–æ–Ω—Ç–∞–Ω–Ω–∞—è —Å–º–µ–Ω–∞)**:
   - –û—Ç–∫—Ä—ã—Ç—å –æ–±—ä–µ–∫—Ç –±–µ–∑ —Ç–∞–π–º-—Å–ª–æ—Ç–∞
   - "–ú–æ–∏ –∑–∞–¥–∞—á–∏" ‚Üí –æ—Ç–º–µ—Ç–∏—Ç—å –∑–∞–¥–∞—á—É
   - –ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: TaskEntryV2, PayrollAdjustment

3. [ ] **E2E-—Ç–µ—Å—Ç (–æ—Ç–º–µ–Ω–∞ —Å–º–µ–Ω—ã)**:
   - –û—Ç–º–µ–Ω–∏—Ç—å —Å–º–µ–Ω—É <24—á —Å –Ω–µ—É–≤–∞–∂–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–∏—á–∏–Ω–æ–π
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —à—Ç—Ä–∞—Ñ 500‚ÇΩ + 1000‚ÇΩ –≤ PayrollAdjustment
   - –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ ‚Üí –ø–æ–≤—Ç–æ—Ä–∏—Ç—å ‚Üí —à—Ç—Ä–∞—Ñ–æ–≤ –Ω–µ—Ç

4. [ ] **E2E-—Ç–µ—Å—Ç (–æ–ø–æ–∑–¥–∞–Ω–∏–µ)**:
   - –û—Ç–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É —Å –æ–ø–æ–∑–¥–∞–Ω–∏–µ–º >10 –º–∏–Ω
   - –ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: —à—Ç—Ä–∞—Ñ 50‚ÇΩ –≤ PayrollAdjustment

### –§–∞–∑–∞ 3: Edge-–∫–µ–π—Å—ã –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞ (1-2 –¥–Ω—è)
1. [ ] –ü–æ–≤—Ç–æ—Ä –±–µ–∑ –¥–∞—Ç—ã –æ–∫–æ–Ω—á–∞–Ω–∏—è
2. [ ] Weekdays –±–µ–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–Ω–µ–π
3. [ ] –ó–∞–¥–∞—á–∞ –±–µ–∑ –ø—Ä–µ–º–∏–∏ (0‚ÇΩ)
4. [ ] Max —Ñ–æ—Ç–æ (3) + –ø–æ–ø—ã—Ç–∫–∞ 4-–≥–æ
5. [ ] Feature flags: –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç

### –§–∞–∑–∞ 4: –¢–µ—Å—Ç—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (1-2 –¥–Ω—è)
1. [ ] –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: Rules Engine, TaskService)
2. [ ] –û–±–Ω–æ–≤–∏—Ç—å `doc/vision_v1/*` –∏ roadmap
3. [ ] –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–æ–Ω –Ω–∞ PROD (—Å feature flags)

---

## –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

- [ ] 0 –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –±–∞–≥–æ–≤
- [ ] –í—Å–µ E2E-—Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ ‚â•80% (Rules Engine, Tasks v2, MediaOrchestrator)
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ü—Ä–æ–¥-–¥–µ–ø–ª–æ–π –±–µ–∑ –æ—Ç–∫–∞—Ç–æ–≤

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-10-28
**–°—Ç–∞—Ç—É—Å**: üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ (70% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ)

