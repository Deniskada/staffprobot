# üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: –ò—Ç–µ—Ä–∞—Ü–∏—è 25

> **–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ –∞–¥–º–∏–Ω–∫–µ**  
> **–í–µ—Ä—Å–∏—è:** 1.0  
> **–î–∞—Ç–∞:** 2024-01-15

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
2. [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-–∏-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
3. [API Reference](#api-reference)
4. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
5. [–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ](#–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
6. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
7. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)
8. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
9. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
10. [Troubleshooting](#troubleshooting)

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Admin Panel                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Dashboard   ‚îÇ ‚îÇ List        ‚îÇ ‚îÇ Analytics   ‚îÇ ‚îÇ Settings‚îÇ‚îÇ
‚îÇ  ‚îÇ (Stats)     ‚îÇ ‚îÇ (Filtered)  ‚îÇ ‚îÇ (Charts)    ‚îÇ ‚îÇ (Channels‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Service Layer                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ Admin       ‚îÇ ‚îÇ Template    ‚îÇ ‚îÇ Channel     ‚îÇ ‚îÇ Bulk    ‚îÇ‚îÇ
‚îÇ  ‚îÇ Notification‚îÇ ‚îÇ Service     ‚îÇ ‚îÇ Service     ‚îÇ ‚îÇ Service ‚îÇ‚îÇ
‚îÇ  ‚îÇ Service     ‚îÇ ‚îÇ             ‚îÇ ‚îÇ             ‚îÇ ‚îÇ         ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                ‚îÇ
                                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Data Layer                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê‚îÇ
‚îÇ  ‚îÇ PostgreSQL  ‚îÇ ‚îÇ Redis Cache ‚îÇ ‚îÇ File System ‚îÇ ‚îÇ External‚îÇ‚îÇ
‚îÇ  ‚îÇ (Main DB)   ‚îÇ ‚îÇ (Stats)     ‚îÇ ‚îÇ (Exports)   ‚îÇ ‚îÇ APIs    ‚îÇ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
User Request ‚Üí Admin Routes ‚Üí Service Layer ‚Üí Database/Cache
     ‚Üì              ‚Üì              ‚Üì              ‚Üì
   Auth Check ‚Üí Validation ‚Üí Business Logic ‚Üí Data Access
     ‚Üì              ‚Üì              ‚Üì              ‚Üì
   Response ‚Üê Template ‚Üê Service Result ‚Üê Query Result
```

---

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 1. –†–æ—É—Ç—ã (`apps/web/routes/admin_notifications.py`)

```python
from fastapi import APIRouter, Request, Depends, HTTPException, Query
from fastapi.responses import HTMLResponse, JSONResponse
from apps.web.middleware.auth_middleware import require_superadmin
from apps.web.services.admin_notification_service import AdminNotificationService
from apps.web.jinja import templates

router = APIRouter()

@router.get("/", response_class=HTMLResponse)
async def admin_notifications_dashboard(
    request: Request,
    current_user: dict = Depends(require_superadmin)
):
    """–ì–ª–∞–≤–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    service = AdminNotificationService()
    stats = await service.get_notifications_stats()
    
    return templates.TemplateResponse("admin/notifications/dashboard.html", {
        "request": request,
        "current_user": current_user,
        "stats": stats
    })

@router.get("/list", response_class=HTMLResponse)
async def admin_notifications_list(
    request: Request,
    current_user: dict = Depends(require_superadmin),
    page: int = Query(1, ge=1),
    per_page: int = Query(50, ge=1, le=100),
    type_filter: Optional[str] = Query(None),
    status_filter: Optional[str] = Query(None),
    channel_filter: Optional[str] = Query(None),
    date_from: Optional[str] = Query(None),
    date_to: Optional[str] = Query(None),
    search: Optional[str] = Query(None)
):
    """–°–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏"""
    service = AdminNotificationService()
    
    filters = {
        "type": type_filter,
        "status": status_filter,
        "channel": channel_filter,
        "date_from": date_from,
        "date_to": date_to,
        "search": search
    }
    
    notifications, total = await service.get_notifications_list(
        page=page, per_page=per_page, filters=filters
    )
    
    return templates.TemplateResponse("admin/notifications/list.html", {
        "request": request,
        "current_user": current_user,
        "notifications": notifications,
        "total": total,
        "page": page,
        "per_page": per_page,
        "filters": filters
    })

@router.get("/analytics", response_class=HTMLResponse)
async def admin_notifications_analytics(
    request: Request,
    current_user: dict = Depends(require_superadmin),
    period: str = Query("30d"),
    type_filter: Optional[str] = Query(None)
):
    """–î–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    service = AdminNotificationService()
    
    analytics = await service.get_detailed_analytics(
        period=period, type_filter=type_filter
    )
    
    return templates.TemplateResponse("admin/notifications/analytics.html", {
        "request": request,
        "current_user": current_user,
        "analytics": analytics,
        "period": period,
        "type_filter": type_filter
    })
```

### 2. –°–µ—Ä–≤–∏—Å—ã

#### AdminNotificationService

```python
from typing import List, Optional, Dict, Any
from datetime import datetime, timedelta
from sqlalchemy import select, func, and_, or_, desc
from sqlalchemy.orm import selectinload
from core.database.session import get_async_session
from core.cache.redis_cache import cached
from domain.entities.notification import Notification, NotificationType, NotificationStatus, NotificationChannel
from domain.entities.payment_notification import PaymentNotification
from shared.services.notification_service import NotificationService

class AdminNotificationService(NotificationService):
    """–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ NotificationService –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏"""
    
    @cached(ttl=timedelta(minutes=10), key_prefix="admin_notifications_stats")
    async def get_notifications_stats(self) -> Dict[str, Any]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–≤–∫–ª—é—á–∞—è PaymentNotification)"""
        async with get_async_session() as session:
            # –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            total_query = select(func.count(Notification.id))
            total_result = await session.execute(total_query)
            total = total_result.scalar()
            
            # –ü–æ —Å—Ç–∞—Ç—É—Å–∞–º
            status_query = select(
                Notification.status,
                func.count(Notification.id).label('count')
            ).group_by(Notification.status)
            status_result = await session.execute(status_query)
            status_stats = {row.status.value: row.count for row in status_result}
            
            # –ü–æ –∫–∞–Ω–∞–ª–∞–º
            channel_query = select(
                Notification.channel,
                func.count(Notification.id).label('count')
            ).group_by(Notification.channel)
            channel_result = await session.execute(channel_query)
            channel_stats = {row.channel.value: row.count for row in channel_result}
            
            # –ü–æ —Ç–∏–ø–∞–º
            type_query = select(
                Notification.type,
                func.count(Notification.id).label('count')
            ).group_by(Notification.type)
            type_result = await session.execute(type_query)
            type_stats = {row.type.value: row.count for row in type_result}
            
            return {
                "total": total,
                "status_stats": status_stats,
                "channel_stats": channel_stats,
                "type_stats": type_stats
            }
    
    async def get_notifications_list(
        self,
        page: int = 1,
        per_page: int = 50,
        filters: Optional[Dict[str, Any]] = None
    ) -> tuple[List[Notification], int]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏"""
        async with get_async_session() as session:
            query = select(Notification).options(
                selectinload(Notification.user)
            )
            
            # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            if filters:
                if filters.get("type"):
                    query = query.where(Notification.type == NotificationType(filters["type"]))
                
                if filters.get("status"):
                    query = query.where(Notification.status == NotificationStatus(filters["status"]))
                
                if filters.get("channel"):
                    query = query.where(Notification.channel == NotificationChannel(filters["channel"]))
                
                if filters.get("date_from"):
                    date_from = datetime.fromisoformat(filters["date_from"])
                    query = query.where(Notification.created_at >= date_from)
                
                if filters.get("date_to"):
                    date_to = datetime.fromisoformat(filters["date_to"])
                    query = query.where(Notification.created_at <= date_to)
                
                if filters.get("search"):
                    search_term = f"%{filters['search']}%"
                    query = query.where(
                        or_(
                            Notification.title.ilike(search_term),
                            Notification.message.ilike(search_term)
                        )
                    )
            
            # –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            count_query = select(func.count()).select_from(query.subquery())
            count_result = await session.execute(count_query)
            total = count_result.scalar()
            
            # –ü–∞–≥–∏–Ω–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            query = query.order_by(desc(Notification.created_at))
            query = query.offset((page - 1) * per_page).limit(per_page)
            
            result = await session.execute(query)
            notifications = result.scalars().all()
            
            return notifications, total
```

#### NotificationTemplateService

```python
from typing import List, Optional, Dict, Any
from sqlalchemy import select, func, and_
from core.database.session import get_async_session
from domain.entities.notification_template import NotificationTemplate

class NotificationTemplateService:
    """–°–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    
    async def get_templates(
        self,
        type_filter: Optional[str] = None,
        page: int = 1,
        per_page: int = 50
    ) -> tuple[List[NotificationTemplate], int]:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤"""
        async with get_async_session() as session:
            query = select(NotificationTemplate).where(
                NotificationTemplate.is_deleted == False
            )
            
            if type_filter:
                query = query.where(NotificationTemplate.type == type_filter)
            
            # –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
            count_query = select(func.count()).select_from(query.subquery())
            count_result = await session.execute(count_query)
            total = count_result.scalar()
            
            # –ü–∞–≥–∏–Ω–∞—Ü–∏—è
            query = query.order_by(NotificationTemplate.created_at.desc())
            query = query.offset((page - 1) * per_page).limit(per_page)
            
            result = await session.execute(query)
            templates = result.scalars().all()
            
            return templates, total
    
    async def create_template(
        self,
        name: str,
        type: str,
        channel: str,
        title: str,
        message: str,
        variables: Optional[List[str]] = None
    ) -> NotificationTemplate:
        """–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞"""
        async with get_async_session() as session:
            template = NotificationTemplate(
                name=name,
                type=type,
                channel=channel,
                title=title,
                message=message,
                variables=variables or []
            )
            
            session.add(template)
            await session.commit()
            await session.refresh(template)
            
            return template
    
    async def test_template(
        self,
        template_id: int,
        test_data: Dict[str, Any]
    ) -> Dict[str, Any]:
        """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏"""
        async with get_async_session() as session:
            template_query = select(NotificationTemplate).where(
                NotificationTemplate.id == template_id
            )
            template_result = await session.execute(template_query)
            template = template_result.scalar_one_or_none()
            
            if not template:
                raise ValueError("Template not found")
            
            # –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —à–∞–±–ª–æ–Ω–∞ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            rendered_title = template.render_title(test_data)
            rendered_message = template.render_message(test_data)
            
            return {
                "rendered_title": rendered_title,
                "rendered_message": rendered_message,
                "variables_used": template.get_used_variables(),
                "missing_variables": template.get_missing_variables(test_data)
            }
```

### 3. –®–∞–±–ª–æ–Ω—ã

#### Dashboard Template

```html
<!-- apps/web/templates/admin/notifications/dashboard.html -->
{% extends "admin/base_admin.html" %}

{% block title %}–î–∞—à–±–æ—Ä–¥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="h3 mb-4">üìä –î–∞—à–±–æ—Ä–¥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h1>
        </div>
    </div>
    
    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">üìß Email</h4>
                            <h2 class="mb-0">{{ stats.channel_stats.get('email', 0) }}</h2>
                            <small>95% –¥–æ—Å—Ç–∞–≤–∫–∞</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-envelope fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">üì± SMS</h4>
                            <h2 class="mb-0">{{ stats.channel_stats.get('sms', 0) }}</h2>
                            <small>98% –¥–æ—Å—Ç–∞–≤–∫–∞</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-sms fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">üîî Push</h4>
                            <h2 class="mb-0">{{ stats.channel_stats.get('push', 0) }}</h2>
                            <small>92% –¥–æ—Å—Ç–∞–≤–∫–∞</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-bell fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <h4 class="card-title">üí¨ Telegram</h4>
                            <h2 class="mb-0">{{ stats.channel_stats.get('telegram', 0) }}</h2>
                            <small>99% –¥–æ—Å—Ç–∞–≤–∫–∞</small>
                        </div>
                        <div class="align-self-center">
                            <i class="fab fa-telegram fa-2x"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ –ø–æ –¥–Ω—è–º</h5>
                </div>
                <div class="card-body">
                    <canvas id="deliveryChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞–Ω–∞–ª–∞–º</h5>
                </div>
                <div class="card-body">
                    <canvas id="channelChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">üë• –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</th>
                                    <th>–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in stats.top_users %}
                                <tr>
                                    <td>{{ user.name }}</td>
                                    <td>{{ user.notifications_count }}</td>
                                    <td>{{ user.read_count }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        {% for notification in stats.recent_notifications %}
                        <div class="list-group-item">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">{{ notification.title }}</h6>
                                <small>{{ notification.created_at|timeago }}</small>
                            </div>
                            <p class="mb-1">{{ notification.message[:100] }}...</p>
                            <small>
                                <span class="badge badge-{{ notification.status|status_color }}">
                                    {{ notification.status|status_label }}
                                </span>
                                <span class="badge badge-secondary">{{ notification.channel|channel_label }}</span>
                            </small>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
const deliveryCtx = document.getElementById('deliveryChart').getContext('2d');
const deliveryChart = new Chart(deliveryCtx, {
    type: 'line',
    data: {
        labels: {{ stats.delivery_chart.labels|tojson }},
        datasets: [{
            label: '–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ',
            data: {{ stats.delivery_chart.delivered|tojson }},
            borderColor: 'rgb(75, 192, 192)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            tension: 0.1
        }, {
            label: '–û—à–∏–±–∫–∏',
            data: {{ stats.delivery_chart.failed|tojson }},
            borderColor: 'rgb(255, 99, 132)',
            backgroundColor: 'rgba(255, 99, 132, 0.2)',
            tension: 0.1
        }]
    },
    options: {
        responsive: true,
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

const channelCtx = document.getElementById('channelChart').getContext('2d');
const channelChart = new Chart(channelCtx, {
    type: 'doughnut',
    data: {
        labels: {{ stats.channel_stats.keys()|list|tojson }},
        datasets: [{
            data: {{ stats.channel_stats.values()|list|tojson }},
            backgroundColor: [
                'rgba(54, 162, 235, 0.8)',
                'rgba(255, 99, 132, 0.8)',
                'rgba(255, 205, 86, 0.8)',
                'rgba(75, 192, 192, 0.8)'
            ]
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
});
</script>
{% endblock %}
```

### 4. JavaScript –º–æ–¥—É–ª–∏

```javascript
// apps/web/static/js/admin/notifications.js
class AdminNotificationsManager {
    constructor() {
        this.init();
    }
    
    init() {
        this.bindEvents();
        this.loadInitialData();
    }
    
    bindEvents() {
        // –§–∏–ª—å—Ç—Ä—ã
        document.querySelectorAll('.filter-input').forEach(input => {
            input.addEventListener('change', () => this.applyFilters());
        });
        
        // –ú–∞—Å—Å–æ–≤—ã–π –≤—ã–±–æ—Ä
        document.getElementById('selectAll').addEventListener('change', (e) => {
            this.toggleSelectAll(e.target.checked);
        });
        
        // –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
        document.querySelectorAll('.bulk-action-btn').forEach(btn => {
            btn.addEventListener('click', (e) => this.handleBulkAction(e.target.dataset.action));
        });
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
        setInterval(() => this.refreshData(), 300000);
    }
    
    async applyFilters() {
        const filters = this.collectFilters();
        const url = new URL(window.location);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        Object.keys(filters).forEach(key => {
            if (filters[key]) {
                url.searchParams.set(key, filters[key]);
            } else {
                url.searchParams.delete(key);
            }
        });
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        await this.loadNotifications(url.searchParams);
    }
    
    collectFilters() {
        return {
            type: document.getElementById('typeFilter').value,
            status: document.getElementById('statusFilter').value,
            channel: document.getElementById('channelFilter').value,
            date_from: document.getElementById('dateFrom').value,
            date_to: document.getElementById('dateTo').value,
            search: document.getElementById('searchInput').value
        };
    }
    
    async loadNotifications(params) {
        try {
            this.showLoading();
            
            const response = await fetch(`/admin/api/notifications?${params}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': this.getCSRFToken()
                }
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json();
            this.updateNotificationsTable(data);
            
        } catch (error) {
            this.showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: ' + error.message);
        } finally {
            this.hideLoading();
        }
    }
    
    updateNotificationsTable(data) {
        const tbody = document.querySelector('#notificationsTable tbody');
        tbody.innerHTML = '';
        
        data.notifications.forEach(notification => {
            const row = this.createNotificationRow(notification);
            tbody.appendChild(row);
        });
        
        this.updatePagination(data.pagination);
    }
    
    createNotificationRow(notification) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <input type="checkbox" class="notification-checkbox" value="${notification.id}">
            </td>
            <td>${notification.id}</td>
            <td>${notification.user.name}</td>
            <td>
                <span class="badge badge-${this.getTypeColor(notification.type)}">
                    ${this.getTypeLabel(notification.type)}
                </span>
            </td>
            <td>
                <span class="badge badge-${this.getChannelColor(notification.channel)}">
                    ${this.getChannelLabel(notification.channel)}
                </span>
            </td>
            <td>
                <span class="badge badge-${this.getStatusColor(notification.status)}">
                    ${this.getStatusLabel(notification.status)}
                </span>
            </td>
            <td>${notification.title}</td>
            <td>${this.formatDate(notification.created_at)}</td>
            <td>
                <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" onclick="viewNotification(${notification.id})">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-outline-danger" onclick="deleteNotification(${notification.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        return row;
    }
    
    async handleBulkAction(action) {
        const selectedIds = this.getSelectedNotificationIds();
        
        if (selectedIds.length === 0) {
            this.showWarning('–í—ã–±–µ—Ä–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏');
            return;
        }
        
        if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ ${this.getActionLabel(action)} ${selectedIds.length} —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π?`)) {
            return;
        }
        
        try {
            this.showLoading();
            
            const response = await fetch(`/admin/api/notifications/bulk/${action}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': this.getCSRFToken()
                },
                body: JSON.stringify({ ids: selectedIds })
            });
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const result = await response.json();
            this.showSuccess(`–û–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ. –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ: ${result.processed}`);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
            await this.refreshData();
            
        } catch (error) {
            this.showError('–û—à–∏–±–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏: ' + error.message);
        } finally {
            this.hideLoading();
        }
    }
    
    getSelectedNotificationIds() {
        const checkboxes = document.querySelectorAll('.notification-checkbox:checked');
        return Array.from(checkboxes).map(cb => parseInt(cb.value));
    }
    
    toggleSelectAll(checked) {
        document.querySelectorAll('.notification-checkbox').forEach(cb => {
            cb.checked = checked;
        });
        this.updateBulkActionButtons();
    }
    
    updateBulkActionButtons() {
        const selectedCount = this.getSelectedNotificationIds().length;
        const buttons = document.querySelectorAll('.bulk-action-btn');
        
        buttons.forEach(btn => {
            btn.disabled = selectedCount === 0;
        });
        
        const counter = document.getElementById('selectedCount');
        if (counter) {
            counter.textContent = selectedCount;
        }
    }
    
    showLoading() {
        const loader = document.getElementById('loadingIndicator');
        if (loader) {
            loader.style.display = 'block';
        }
    }
    
    hideLoading() {
        const loader = document.getElementById('loadingIndicator');
        if (loader) {
            loader.style.display = 'none';
        }
    }
    
    showSuccess(message) {
        this.showToast(message, 'success');
    }
    
    showError(message) {
        this.showToast(message, 'error');
    }
    
    showWarning(message) {
        this.showToast(message, 'warning');
    }
    
    showToast(message, type) {
        // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        const toast = document.createElement('div');
        toast.className = `toast toast-${type}`;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.remove();
        }, 3000);
    }
    
    getCSRFToken() {
        return document.querySelector('meta[name="csrf-token"]').getAttribute('content');
    }
    
    getTypeColor(type) {
        const colors = {
            'shift_reminder': 'primary',
            'contract_signed': 'success',
            'review_received': 'info',
            'payment_due': 'warning',
            'system_maintenance': 'secondary'
        };
        return colors[type] || 'secondary';
    }
    
    getChannelColor(channel) {
        const colors = {
            'email': 'primary',
            'sms': 'success',
            'push': 'warning',
            'telegram': 'info'
        };
        return colors[channel] || 'secondary';
    }
    
    getStatusColor(status) {
        const colors = {
            'pending': 'warning',
            'sent': 'info',
            'delivered': 'success',
            'failed': 'danger',
            'read': 'primary',
            'cancelled': 'secondary'
        };
        return colors[status] || 'secondary';
    }
    
    formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleString('ru-RU');
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    new AdminNotificationsManager();
});
```

---

## üóÑ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```sql
-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã notifications
CREATE INDEX CONCURRENTLY idx_notifications_user_id ON notifications(user_id);
CREATE INDEX CONCURRENTLY idx_notifications_status ON notifications(status);
CREATE INDEX CONCURRENTLY idx_notifications_created_at ON notifications(created_at);
CREATE INDEX CONCURRENTLY idx_notifications_type ON notifications(type);
CREATE INDEX CONCURRENTLY idx_notifications_channel ON notifications(channel);
CREATE INDEX CONCURRENTLY idx_notifications_scheduled_at ON notifications(scheduled_at);

-- –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE INDEX CONCURRENTLY idx_notifications_user_status ON notifications(user_id, status);
CREATE INDEX CONCURRENTLY idx_notifications_type_channel ON notifications(type, channel);
CREATE INDEX CONCURRENTLY idx_notifications_created_status ON notifications(created_at, status);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX CONCURRENTLY idx_notifications_title_gin ON notifications USING gin(to_tsvector('russian', title));
CREATE INDEX CONCURRENTLY idx_notifications_message_gin ON notifications USING gin(to_tsvector('russian', message));
```

### –ó–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

```sql
-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–Ω–∞–ª–∞–º –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
SELECT 
    channel,
    COUNT(*) as total,
    COUNT(CASE WHEN status = 'delivered' THEN 1 END) as delivered,
    COUNT(CASE WHEN status = 'failed' THEN 1 END) as failed,
    ROUND(
        COUNT(CASE WHEN status = 'delivered' THEN 1 END) * 100.0 / COUNT(*), 
        2
    ) as delivery_rate
FROM notifications 
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY channel
ORDER BY total DESC;

-- –¢–æ–ø –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
SELECT 
    u.name,
    u.role,
    COUNT(n.id) as notifications_count,
    COUNT(CASE WHEN n.status = 'read' THEN 1 END) as read_count,
    ROUND(
        COUNT(CASE WHEN n.status = 'read' THEN 1 END) * 100.0 / COUNT(n.id), 
        2
    ) as read_rate
FROM notifications n
JOIN users u ON n.user_id = u.id
WHERE n.created_at >= NOW() - INTERVAL '30 days'
GROUP BY u.id, u.name, u.role
ORDER BY notifications_count DESC
LIMIT 10;

-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
SELECT 
    type,
    COUNT(*) as total,
    COUNT(CASE WHEN status = 'delivered' THEN 1 END) as delivered,
    COUNT(CASE WHEN status = 'read' THEN 1 END) as read,
    AVG(EXTRACT(EPOCH FROM (read_at - sent_at))/60) as avg_read_time_minutes
FROM notifications 
WHERE created_at >= NOW() - INTERVAL '30 days'
GROUP BY type
ORDER BY total DESC;
```

---

## ‚ö° –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

```python
from core.cache.redis_cache import cached
from datetime import timedelta

class AdminNotificationService:
    
    @cached(ttl=timedelta(minutes=10), key_prefix="admin_notifications_stats")
    async def get_notifications_stats(self) -> Dict[str, Any]:
        """–ö—ç—à–∏—Ä—É–µ–º –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞ 10 –º–∏–Ω—É—Ç"""
        # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    
    @cached(ttl=timedelta(minutes=5), key_prefix="admin_notifications_list")
    async def get_notifications_list(self, **kwargs) -> tuple[List[Notification], int]:
        """–ö—ç—à–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–∞ 5 –º–∏–Ω—É—Ç"""
        # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    
    @cached(ttl=timedelta(minutes=15), key_prefix="admin_notifications_analytics")
    async def get_detailed_analytics(self, **kwargs) -> Dict[str, Any]:
        """–ö—ç—à–∏—Ä—É–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É –Ω–∞ 15 –º–∏–Ω—É—Ç"""
        # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    
    async def invalidate_cache(self, cache_keys: List[str]):
        """–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö"""
        cache_service = CacheService()
        for key in cache_keys:
            await cache_service.delete(key)
```

### –ö–ª—é—á–∏ –∫—ç—à–∞

```python
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á–µ–π –∫—ç—à–∞
CACHE_KEYS = {
    "stats": "admin_notifications_stats",
    "list": "admin_notifications_list:{hash}",
    "analytics": "admin_notifications_analytics:{period}:{type_filter}",
    "templates": "admin_notifications_templates:{type_filter}",
    "channel_settings": "admin_notifications_channel_settings"
}
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

```python
from apps.web.middleware.auth_middleware import require_superadmin
from fastapi import Depends, HTTPException

@router.get("/admin/notifications/")
async def admin_notifications_dashboard(
    request: Request,
    current_user: dict = Depends(require_superadmin)
):
    """–¢–æ–ª—å–∫–æ —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
class AdminNotificationService:
    async def validate_admin_access(self, user_id: int) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω—Å–∫–∏–º —Ñ—É–Ω–∫—Ü–∏—è–º"""
        async with get_async_session() as session:
            user_query = select(User).where(User.id == user_id)
            user_result = await session.execute(user_query)
            user = user_result.scalar_one_or_none()
            
            return user and user.role == UserRole.SUPERADMIN
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```python
from pydantic import BaseModel, validator
from typing import Optional, List

class NotificationFilterRequest(BaseModel):
    type: Optional[str] = None
    status: Optional[str] = None
    channel: Optional[str] = None
    date_from: Optional[str] = None
    date_to: Optional[str] = None
    search: Optional[str] = None
    page: int = 1
    per_page: int = 50
    
    @validator('type')
    def validate_type(cls, v):
        if v and v not in [t.value for t in NotificationType]:
            raise ValueError('Invalid notification type')
        return v
    
    @validator('status')
    def validate_status(cls, v):
        if v and v not in [s.value for s in NotificationStatus]:
            raise ValueError('Invalid notification status')
        return v
    
    @validator('per_page')
    def validate_per_page(cls, v):
        if v > 100:
            raise ValueError('per_page cannot exceed 100')
        return v
```

### Rate Limiting

```python
from core.middleware.rate_limit import rate_limit

@router.post("/admin/api/notifications/bulk/cancel")
@rate_limit(requests=10, window=60)  # 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
async def bulk_cancel_notifications(
    request: BulkActionRequest,
    current_user: dict = Depends(require_superadmin)
):
    """–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏"""
    # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
```

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ selectinload –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è N+1 –ø—Ä–æ–±–ª–µ–º
async def get_notifications_with_users(self):
    async with get_async_session() as session:
        query = select(Notification).options(
            selectinload(Notification.user)
        ).order_by(desc(Notification.created_at))
        
        result = await session.execute(query)
        return result.scalars().all()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
async def get_channel_stats(self):
    async with get_async_session() as session:
        subquery = select(
            Notification.channel,
            func.count(Notification.id).label('total'),
            func.count(CASE(Notification.status == 'delivered', 1)).label('delivered'),
            func.count(CASE(Notification.status == 'failed', 1)).label('failed')
        ).where(
            Notification.created_at >= datetime.now() - timedelta(days=30)
        ).group_by(Notification.channel).subquery()
        
        query = select(subquery)
        result = await session.execute(query)
        return result.fetchall()
```

### –ü–∞–≥–∏–Ω–∞—Ü–∏—è

```python
async def get_paginated_notifications(
    self,
    page: int = 1,
    per_page: int = 50,
    filters: Optional[Dict[str, Any]] = None
) -> tuple[List[Notification], int, Dict[str, Any]]:
    """–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏"""
    async with get_async_session() as session:
        # –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
        base_query = select(Notification)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
        if filters:
            base_query = self.apply_filters(base_query, filters)
        
        # –ü–æ–¥—Å—á–µ—Ç –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        count_query = select(func.count()).select_from(base_query.subquery())
        count_result = await session.execute(count_query)
        total = count_result.scalar()
        
        # –í—ã—á–∏—Å–ª—è–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é
        total_pages = (total + per_page - 1) // per_page
        offset = (page - 1) * per_page
        
        # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        data_query = base_query.order_by(desc(Notification.created_at))
        data_query = data_query.offset(offset).limit(per_page)
        
        result = await session.execute(data_query)
        notifications = result.scalars().all()
        
        # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
        pagination = {
            "page": page,
            "per_page": per_page,
            "total": total,
            "total_pages": total_pages,
            "has_prev": page > 1,
            "has_next": page < total_pages,
            "prev_page": page - 1 if page > 1 else None,
            "next_page": page + 1 if page < total_pages else None
        }
        
        return notifications, total, pagination
```

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```yaml
# docker-compose.prod.yml
version: '3.8'

services:
  web:
    build: .
    environment:
      - NOTIFICATION_CACHE_TTL=600
      - EXPORT_MAX_RECORDS=10000
      - EXPORT_TEMP_DIR=/tmp
    volumes:
      - ./exports:/app/exports
    depends_on:
      - postgres
      - redis

  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: staffprobot_prod
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
docker compose -f docker-compose.prod.yml exec web alembic upgrade head

# –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
docker compose -f docker-compose.prod.yml exec web alembic revision --autogenerate -m "Add notification admin features"
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# .env
# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
NOTIFICATION_CACHE_TTL=600
ANALYTICS_CACHE_TTL=600

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞
EXPORT_MAX_RECORDS=10000
EXPORT_TEMP_DIR=/tmp

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
ADMIN_RATE_LIMIT=10
ADMIN_RATE_WINDOW=60
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

```python
from core.monitoring.metrics import metrics

class AdminNotificationService:
    
    @metrics.timer('admin_notifications_stats_duration')
    async def get_notifications_stats(self):
        """–ú–µ—Ç—Ä–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"""
        # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    
    @metrics.counter('admin_notifications_bulk_operations')
    async def bulk_cancel_notifications(self, notification_ids: List[int]):
        """–°—á–µ—Ç—á–∏–∫ –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"""
        metrics.increment('admin_notifications_bulk_cancel', len(notification_ids))
        # ... —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
from core.logging.logger import logger

class AdminNotificationService:
    
    async def bulk_cancel_notifications(self, notification_ids: List[int], admin_user_id: int):
        """–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"""
        logger.info(
            "Bulk cancel notifications started",
            admin_user_id=admin_user_id,
            notification_count=len(notification_ids),
            notification_ids=notification_ids
        )
        
        try:
            # ... –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
            
            logger.info(
                "Bulk cancel notifications completed",
                admin_user_id=admin_user_id,
                cancelled_count=cancelled_count
            )
            
        except Exception as e:
            logger.error(
                "Bulk cancel notifications failed",
                admin_user_id=admin_user_id,
                error=str(e),
                notification_ids=notification_ids
            )
            raise
```

---

## üîß Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞—à–±–æ—Ä–¥–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–æ–ª–µ–µ 5 —Å–µ–∫—É–Ω–¥

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–¥–µ–∫—Å—ã –≤ –ë–î
SELECT indexname, indexdef FROM pg_indexes WHERE tablename = 'notifications';

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX CONCURRENTLY idx_notifications_created_at_status ON notifications(created_at, status);

# –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º –∑–∞–ø—Ä–æ—Å—ã
async def get_notifications_stats_optimized(self):
    async with get_async_session() as session:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        query = select(text("""
            SELECT 
                channel,
                COUNT(*) as total,
                COUNT(CASE WHEN status = 'delivered' THEN 1 END) as delivered
            FROM notifications_mv
            WHERE created_at >= NOW() - INTERVAL '30 days'
            GROUP BY channel
        """))
        result = await session.execute(query)
        return result.fetchall()
```

#### 2. –û—à–∏–±–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö—ç—à –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
async def create_notification(self, **kwargs):
    notification = await super().create_notification(**kwargs)
    
    # –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫—ç—à–∏
    await self.invalidate_cache([
        "admin_notifications_stats",
        f"admin_notifications_list:*",
        f"admin_notifications_analytics:*"
    ])
    
    return notification
```

#### 3. –ü—Ä–æ–±–ª–µ–º—ã —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠–∫—Å–ø–æ—Ä—Ç –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö –ø–∞–¥–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü–æ—Ç–æ–∫–æ–≤—ã–π —ç–∫—Å–ø–æ—Ä—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
async def export_notifications_stream(self, filters: Dict[str, Any]):
    """–ü–æ—Ç–æ–∫–æ–≤—ã–π —ç–∫—Å–ø–æ—Ä—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π"""
    async with get_async_session() as session:
        query = select(Notification).where(
            Notification.created_at >= filters.get('date_from'),
            Notification.created_at <= filters.get('date_to')
        )
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º stream –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        async for notification in session.stream(query):
            yield notification.to_dict()
```

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
docker compose -f docker-compose.prod.yml exec postgres psql -U postgres -d staffprobot_prod -c "
EXPLAIN ANALYZE SELECT COUNT(*) FROM notifications WHERE created_at >= NOW() - INTERVAL '30 days';
"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫—ç—à–∞
docker compose -f docker-compose.prod.yml exec redis redis-cli info memory

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose -f docker-compose.prod.yml logs web | grep "admin_notifications"
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [SQLAlchemy 2.0 Documentation](https://docs.sqlalchemy.org/en/20/)
- [Chart.js Documentation](https://www.chartjs.org/docs/)
- [Redis Documentation](https://redis.io/documentation)
- [PostgreSQL Performance Tuning](https://www.postgresql.org/docs/current/performance-tips.html)

---

## üîß –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (14 –æ–∫—Ç—è–±—Ä—è 2025)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–∞–Ω–∏—Ü—ã —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏/–Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏ —à–∞–±–ª–æ–Ω–∞–º–∏

#### –ü—Ä–æ–±–ª–µ–º–∞
–í —Å–ø–∏—Å–∫–µ —à–∞–±–ª–æ–Ω–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã, –∞ –∫–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å" –∏—Ö –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∞, —Å–æ–∑–¥–∞–≤–∞—è –ø—É—Ç–∞–Ω–∏—Ü—É –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.

#### –†–µ—à–µ–Ω–∏–µ

**1. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**
```python
# apps/web/services/notification_template_service.py
async def get_templates_paginated(self, ..., is_active: Optional[bool] = None):
    # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
    if is_active is None:
        filters.append(NotificationTemplate.is_active == True)
    elif is_active is not None:
        filters.append(NotificationTemplate.is_active == is_active)
```

**2. –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –≤ UI**
```html
<!-- apps/web/templates/admin/notifications/templates/list.html -->
<div class="col-md-3">
    <label for="status_filter" class="form-label">–°—Ç–∞—Ç—É—Å</label>
    <select class="form-select" id="status_filter" name="status_filter">
        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
        <option value="active">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
        <option value="inactive">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
    </select>
</div>
```

**3. –£–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π**
```html
{% if template.is_active %}
    <button class="btn btn-sm btn-danger" 
            onclick="deleteTemplate('{{ template.id }}')"
            title="–£–¥–∞–ª–∏—Ç—å">
        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
    </button>
{% else %}
    <button class="btn btn-sm btn-success" 
            onclick="restoreTemplate('{{ template.id }}')"
            title="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å">
        <i class="fas fa-undo"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
    </button>
{% endif %}
```

**4. API –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**
```python
# apps/web/routes/admin_notifications.py
@router.post("/api/templates/restore/{template_id}")
async def admin_notifications_api_template_restore(
    template_id: int,
    current_user: dict = Depends(require_superadmin),
    db: AsyncSession = Depends(get_db_session)
):
    """API: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ (–∞–∫—Ç–∏–≤–∞—Ü–∏—è)"""
    service = NotificationTemplateService(db)
    await service.restore_template(template_id)
    return JSONResponse({"status": "success", "message": "–®–∞–±–ª–æ–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª—ë–Ω"})
```

**5. –ú–µ—Ç–æ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Å–µ—Ä–≤–∏—Å–µ**
```python
# apps/web/services/notification_template_service.py
async def restore_template(self, template_id: int) -> None:
    """–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ (–∞–∫—Ç–∏–≤–∞—Ü–∏—è)"""
    template = await self.get_template_by_id(template_id)
    if not template:
        raise ValueError(f"–®–∞–±–ª–æ–Ω —Å ID {template_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
    
    template.is_active = True
    await self.session.commit()
```

#### –†–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ = –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è (—à–∞–±–ª–æ–Ω –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞)
- ‚úÖ –§–∏–ª—å—Ç—Ä "–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–¥–∞–ª–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å" –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —à–∞–±–ª–æ–Ω –æ–±—Ä–∞—Ç–Ω–æ
- ‚úÖ –õ–æ–≥–∏—á–Ω–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å —à–∞–±–ª–æ–Ω–∞–º–∏

---

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Ç–µ—Ä–∞—Ü–∏–∏ 25 –∑–∞–≤–µ—Ä—à–µ–Ω–æ! üöÄ**
