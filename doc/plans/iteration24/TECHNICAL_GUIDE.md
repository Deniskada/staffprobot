# ğŸ“– Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ Ñ€ÑƒĞºĞ¾Ğ²Ğ¾Ğ´ÑÑ‚Ğ²Ğ¾ â€” Ğ˜Ñ‚ĞµÑ€Ğ°Ñ†Ğ¸Ñ 24

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NotificationService                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Create     â”‚  â”‚   Retrieve   â”‚  â”‚   Update     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â–¼                  â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Notification Model                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  user_id | type | channel | status | priority        â”‚   â”‚
â”‚  â”‚  title | message | data | scheduled_at | sent_at     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Channel Router                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Email   â”‚  â”‚   SMS    â”‚  â”‚   Push   â”‚  â”‚ Telegram â”‚   â”‚
â”‚  â”‚ Channel  â”‚  â”‚ Channel  â”‚  â”‚ Channel  â”‚  â”‚ Channel  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Delivery Status                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Pending  â”‚  â”‚   Sent   â”‚  â”‚Delivered â”‚  â”‚  Failed  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²

### ĞĞ¾Ğ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

```
staffprobot/
â”œâ”€â”€ domain/entities/
â”‚   â”œâ”€â”€ notification.py              # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
â”‚   â””â”€â”€ notification_preferences.py  # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹
â”‚
â”œâ”€â”€ core/notifications/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_channel.py              # Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹ ĞºĞ»Ğ°ÑÑ ĞºĞ°Ğ½Ğ°Ğ»Ğ°
â”‚   â”œâ”€â”€ email_channel.py             # Email Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°
â”‚   â”œâ”€â”€ sms_channel.py               # SMS Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°
â”‚   â”œâ”€â”€ push_channel.py              # Web Push Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°
â”‚   â”œâ”€â”€ telegram_channel.py          # Telegram Ğ´Ğ¾ÑÑ‚Ğ°Ğ²ĞºĞ°
â”‚   â””â”€â”€ channel_router.py            # ĞœĞ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ‚Ğ¾Ñ€ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²
â”‚
â”œâ”€â”€ core/utils/
â”‚   â””â”€â”€ notification_rate_limiter.py # Rate limiting
â”‚
â”œâ”€â”€ shared/services/
â”‚   â”œâ”€â”€ notification_service.py      # ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ (Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½)
â”‚   â””â”€â”€ notification_analytics.py    # ĞĞ½Ğ°Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°
â”‚
â”œâ”€â”€ shared/templates/notifications/
â”‚   â”œâ”€â”€ base_templates.py            # Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹
â”‚   â”œâ”€â”€ email/                       # HTML ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Ğ´Ğ»Ñ email
â”‚   â”‚   â”œâ”€â”€ base.html
â”‚   â”‚   â”œâ”€â”€ shift_reminder.html
â”‚   â”‚   â”œâ”€â”€ contract_signed.html
â”‚   â”‚   â””â”€â”€ daily_digest.html
â”‚   â””â”€â”€ sms/                         # Text ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹ Ğ´Ğ»Ñ SMS
â”‚       â””â”€â”€ templates.txt
â”‚
â”œâ”€â”€ apps/web/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ notifications.py         # API endpoints (Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½)
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â””â”€â”€ shared/
â”‚   â”‚       â””â”€â”€ notification_settings.html  # UI Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ js/
â”‚       â”‚   â”œâ”€â”€ push_notifications.js       # Push Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°
â”‚       â”‚   â””â”€â”€ sw.js                       # Service Worker
â”‚       â””â”€â”€ css/
â”‚           â””â”€â”€ notifications.css
â”‚
â”œâ”€â”€ core/celery/tasks/
â”‚   â””â”€â”€ notification_scheduler.py    # Celery Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”‚   â”œâ”€â”€ test_notification_service.py
    â”‚   â””â”€â”€ test_channels.py
    â””â”€â”€ integration/
        â””â”€â”€ test_notification_flow.py
```

---

## ĞœĞ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Notification

```python
class Notification(Base):
    __tablename__ = "notifications"
    
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey("users.id"), nullable=False, index=True)
    
    # Ğ¢Ğ¸Ğ¿ Ğ¸ ĞºĞ°Ğ½Ğ°Ğ»
    type = Column(Enum(NotificationType), nullable=False)
    channel = Column(Enum(NotificationChannel), nullable=False)
    
    # Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¸ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚
    status = Column(Enum(NotificationStatus), default=NotificationStatus.PENDING)
    priority = Column(Enum(NotificationPriority), default=NotificationPriority.NORMAL)
    
    # Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ
    title = Column(String(200), nullable=False)
    message = Column(Text, nullable=False)
    data = Column(JSON, nullable=True)  # Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
    
    # Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ Ğ¼ĞµÑ‚ĞºĞ¸
    created_at = Column(DateTime(timezone=True), server_default=func.now())
    scheduled_at = Column(DateTime(timezone=True), nullable=True)
    sent_at = Column(DateTime(timezone=True), nullable=True)
    read_at = Column(DateTime(timezone=True), nullable=True)
    
    # ĞÑ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ
    user = relationship("User", back_populates="notifications")
```

### NotificationPreferences

```python
class NotificationPreferences(Base):
    __tablename__ = "notification_preferences"
    
    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey("users.id"), unique=True)
    
    # ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼ (JSON)
    # {
    #   "shift": {"enabled": true, "channels": ["email", "telegram"], "frequency": "instant"},
    #   "contract": {"enabled": true, "channels": ["email"], "frequency": "instant"},
    #   ...
    # }
    preferences = Column(JSON, nullable=False, default={})
    
    # ĞĞ±Ñ‰Ğ¸Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
    email_verified = Column(Boolean, default=False)
    phone_verified = Column(Boolean, default=False)
    push_subscriptions = Column(JSON, default=[])  # Web Push subscriptions
    
    updated_at = Column(DateTime(timezone=True), onupdate=func.now())
    
    user = relationship("User", back_populates="notification_preferences")
```

---

## API Endpoints

### Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ

```python
# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
GET /api/notifications?status=unread&type=shift&limit=20&offset=0
Response: {
    "total": 42,
    "unread_count": 15,
    "notifications": [
        {
            "id": 1,
            "type": "shift",
            "title": "ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ Ğ¾ ÑĞ¼ĞµĞ½Ğµ",
            "message": "Ğ¡Ğ¼ĞµĞ½Ğ° Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· 2 Ñ‡Ğ°ÑĞ°",
            "created_at": "2025-10-09T10:00:00Z",
            "is_read": false,
            "priority": "high"
        }
    ]
}

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ½ĞµĞ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ñ…
GET /api/notifications/unread/count
Response: {"count": 15}

# ĞÑ‚Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ ĞºĞ°Ğº Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ğ¾Ğµ
POST /api/notifications/{id}/read
Response: {"success": true}

# ĞÑ‚Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ²ÑĞµ ĞºĞ°Ğº Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ğµ
POST /api/notifications/read-all
Response: {"success": true, "marked": 15}

# Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
DELETE /api/notifications/{id}
Response: {"success": true}
```

### ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹

```python
# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
GET /api/notifications/preferences
Response: {
    "shift": {
        "enabled": true,
        "channels": ["email", "telegram"],
        "frequency": "instant"
    },
    "contract": {
        "enabled": true,
        "channels": ["email"],
        "frequency": "instant"
    },
    ...
}

# ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
POST /api/notifications/preferences
Body: {
    "shift": {
        "enabled": true,
        "channels": ["email", "telegram", "push"],
        "frequency": "instant"
    }
}
Response: {"success": true}

# ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ Ğ½Ğ° Push
POST /api/notifications/push/subscribe
Body: {
    "endpoint": "https://...",
    "keys": {...}
}
Response: {"success": true}

# ĞÑ‚Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒÑÑ Ğ¾Ñ‚ Push
POST /api/notifications/push/unsubscribe
Body: {"endpoint": "https://..."}
Response: {"success": true}
```

### ĞĞ´Ğ¼Ğ¸Ğ½ĞºĞ°

```python
# Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ°
GET /admin/notifications/analytics?date_from=2025-10-01&date_to=2025-10-09
Response: {
    "total_sent": 1524,
    "by_channel": {
        "email": 824,
        "telegram": 600,
        "sms": 50,
        "push": 50
    },
    "delivery_rate": 0.95,
    "read_rate": 0.72,
    "error_rate": 0.05
}

# ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
POST /admin/notifications/test
Body: {
    "user_id": 123,
    "type": "shift",
    "channel": "email"
}
Response: {"success": true, "notification_id": 9999}
```

---

## Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ² ĞºĞ¾Ğ´Ğµ

### Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ

```python
from shared.services.notification_service import NotificationService
from domain.entities.notification import NotificationType, NotificationChannel

# Ğ’ Ñ€Ğ¾ÑƒÑ‚Ğ°Ñ…/ÑĞµÑ€Ğ²Ğ¸ÑĞ°Ñ…
notification_service = NotificationService(session)

# ĞŸÑ€Ğ¾ÑÑ‚Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
await notification_service.create_notification(
    user_id=user.id,
    type=NotificationType.SHIFT,
    channel=NotificationChannel.TELEGRAM,
    title="ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ Ğ¾ ÑĞ¼ĞµĞ½Ğµ",
    message="Ğ¡Ğ¼ĞµĞ½Ğ° Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· 2 Ñ‡Ğ°ÑĞ° Ğ½Ğ° Ğ¾Ğ±ÑŠĞµĞºÑ‚Ğµ {object_name}",
    data={"object_id": 1, "shift_id": 42}
)

# Ğ—Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ
from datetime import datetime, timedelta

await notification_service.create_notification(
    user_id=user.id,
    type=NotificationType.CONTRACT,
    channel=NotificationChannel.EMAIL,
    title="Ğ”Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€ Ğ¸ÑÑ‚ĞµĞºĞ°ĞµÑ‚",
    message="Ğ’Ğ°Ñˆ Ğ´Ğ¾Ğ³Ğ¾Ğ²Ğ¾Ñ€ Ğ¸ÑÑ‚ĞµĞºĞ°ĞµÑ‚ Ñ‡ĞµÑ€ĞµĞ· 7 Ğ´Ğ½ĞµĞ¹",
    scheduled_at=datetime.now() + timedelta(days=7)
)

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğ°
from shared.templates.notifications.base_templates import NotificationTemplateManager

template_manager = NotificationTemplateManager()
rendered = template_manager.render(
    template_name="shift_reminder",
    channel=NotificationChannel.EMAIL,
    user_name="Ğ˜Ğ²Ğ°Ğ½ Ğ˜Ğ²Ğ°Ğ½Ğ¾Ğ²",
    object_name="ĞÑ„Ğ¸Ñ Ğ",
    shift_time="14:00-22:00"
)

await notification_service.create_notification(
    user_id=user.id,
    type=NotificationType.SHIFT,
    channel=NotificationChannel.EMAIL,
    title=rendered["title"],
    message=rendered["message"]
)
```

### ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ

```python
# Ğ¡ĞµÑ€Ğ²Ğ¸Ñ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹
# Ğ•ÑĞ»Ğ¸ ĞºĞ°Ğ½Ğ°Ğ» Ğ¾Ñ‚ĞºĞ»ÑÑ‡ĞµĞ½ - ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ

# ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸
preferences = await notification_service.get_user_preferences(user_id)

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ, Ğ²ĞºĞ»ÑÑ‡ĞµĞ½ Ğ»Ğ¸ Ñ‚Ğ¸Ğ¿
if preferences.is_enabled(NotificationType.SHIFT):
    # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ°Ğ½Ğ°Ğ»Ñ‹
    channels = preferences.get_channels(NotificationType.SHIFT)
    # ["email", "telegram"]
```

### ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ´Ğ°Ğ¹Ğ´Ğ¶ĞµÑÑ‚Ğ°

```python
from core.celery.tasks.notification_scheduler import send_daily_digests

# Celery Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° (Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸)
send_daily_digests.delay()

# Ğ˜Ğ»Ğ¸ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ
await notification_service.create_and_send_digest(
    user_id=user.id,
    period="daily"  # hourly, daily
)
```

---

## ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ğ½Ğ°Ğ»Ğ¾Ğ²

### Email (SMTP)

```python
# .env
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=notifications@staffprobot.ru
SMTP_PASSWORD=app_specific_password
SMTP_FROM=StaffProBot <notifications@staffprobot.ru>
SMTP_TLS=true

# Ğ”Ğ»Ñ Gmail: Ğ²ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ "App Passwords"
# Ğ”Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ…: Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ SMTP
```

### SMS (Twilio)

```python
# .env
SMS_PROVIDER=twilio  # twilio, smsc, smsaero
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=***
TWILIO_PHONE_NUMBER=+79991234567

# ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ°: SMSC.ru
SMSC_LOGIN=your_login
SMSC_PASSWORD=***
SMSC_SENDER=StaffProBot
```

### Push (Web Push)

```python
# Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ VAPID ĞºĞ»ÑÑ‡ĞµĞ¹:
# pip install pywebpush
# python -c "from pywebpush import webpush; print(webpush.generate_vapid_keys())"

# .env
VAPID_PUBLIC_KEY=BD...
VAPID_PRIVATE_KEY=***
VAPID_SUBJECT=mailto:admin@staffprobot.ru
```

### Telegram (ÑƒĞ¶Ğµ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½)

```python
# .env
TELEGRAM_BOT_TOKEN=123456:ABC...
```

---

## Celery Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸

### ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº

```python
# core/celery/tasks/notification_scheduler.py

@celery_app.task
def process_scheduled_notifications():
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ (ĞºĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚)."""
    # ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ²ÑĞµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ñ scheduled_at <= now Ğ¸ status = pending
    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğ¹ ĞºĞ°Ğ½Ğ°Ğ»
    # ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ status Ğ½Ğ° sent/failed
    pass

@celery_app.task
def send_hourly_digests():
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ‡Ğ°ÑĞ¾Ğ²Ñ‹Ñ… Ğ´Ğ°Ğ¹Ğ´Ğ¶ĞµÑÑ‚Ğ¾Ğ² (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ)."""
    # ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ñ frequency = hourly_digest
    # Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ñ‡Ğ°Ñ
    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ¹Ğ´Ğ¶ĞµÑÑ‚
    pass

@celery_app.task
def send_daily_digests():
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ĞµĞ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ñ… Ğ´Ğ°Ğ¹Ğ´Ğ¶ĞµÑÑ‚Ğ¾Ğ² (ĞºĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² 9:00)."""
    # ĞĞ°Ğ¹Ñ‚Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ñ frequency = daily_digest
    # Ğ¡Ğ¾Ğ±Ñ€Ğ°Ñ‚ÑŒ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ Ğ·Ğ° Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ´ĞµĞ½ÑŒ
    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ°Ğ¹Ğ´Ğ¶ĞµÑÑ‚
    pass

@celery_app.task
def cleanup_old_notifications():
    """ĞÑ‡Ğ¸ÑÑ‚ĞºĞ° ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ‹Ñ… ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹ (Ñ€Ğ°Ğ· Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ)."""
    # Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ read_at < 30 Ğ´Ğ½ĞµĞ¹ Ğ½Ğ°Ğ·Ğ°Ğ´
    pass
```

### Beat Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ

```python
# core/celery/celery_app.py

app.conf.beat_schedule = {
    'process-scheduled-notifications': {
        'task': 'core.celery.tasks.notification_scheduler.process_scheduled_notifications',
        'schedule': crontab(minute='*/5'),  # ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
    },
    'send-hourly-digests': {
        'task': 'core.celery.tasks.notification_scheduler.send_hourly_digests',
        'schedule': crontab(minute=0),  # ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ñ‡Ğ°Ñ
    },
    'send-daily-digests': {
        'task': 'core.celery.tasks.notification_scheduler.send_daily_digests',
        'schedule': crontab(hour=9, minute=0),  # ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ´ĞµĞ½ÑŒ Ğ² 9:00
    },
    'cleanup-old-notifications': {
        'task': 'core.celery.tasks.notification_scheduler.cleanup_old_notifications',
        'schedule': crontab(day_of_week=1, hour=3, minute=0),  # ĞŸĞ¾Ğ½ĞµĞ´ĞµĞ»ÑŒĞ½Ğ¸Ğº Ğ² 3:00
    },
}
```

---

## Ğ¢ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

### Unit Ñ‚ĞµÑÑ‚Ñ‹

```python
# tests/unit/test_notification_service.py

import pytest
from shared.services.notification_service import NotificationService

@pytest.mark.asyncio
async def test_create_notification(session, test_user):
    service = NotificationService(session)
    
    notification = await service.create_notification(
        user_id=test_user.id,
        type=NotificationType.SHIFT,
        channel=NotificationChannel.EMAIL,
        title="Test",
        message="Test message"
    )
    
    assert notification.id is not None
    assert notification.status == NotificationStatus.PENDING

@pytest.mark.asyncio
async def test_mark_as_read(session, test_notification):
    service = NotificationService(session)
    
    success = await service.mark_as_read(test_notification.id)
    
    assert success
    assert test_notification.read_at is not None
```

### Integration Ñ‚ĞµÑÑ‚Ñ‹

```python
# tests/integration/test_notification_flow.py

@pytest.mark.asyncio
async def test_full_notification_flow(session, test_user, mock_email):
    """Ğ¢ĞµÑÑ‚ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ğ°: ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ â†’ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ â†’ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° â†’ Ñ‡Ñ‚ĞµĞ½Ğ¸Ğµ."""
    service = NotificationService(session)
    
    # 1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ
    notification = await service.create_notification(
        user_id=test_user.id,
        type=NotificationType.SHIFT,
        channel=NotificationChannel.EMAIL,
        title="Test",
        message="Test message",
        scheduled_at=datetime.now() + timedelta(minutes=1)
    )
    
    # 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾ÑÑ‚Ğ¸
    assert notification.is_scheduled()
    
    # 3. Ğ­Ğ¼ÑƒĞ»ÑÑ†Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸ĞºĞ¾Ğ¼
    from core.celery.tasks.notification_scheduler import process_scheduled_notifications
    process_scheduled_notifications()
    
    # 4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
    await session.refresh(notification)
    assert notification.status == NotificationStatus.SENT
    assert notification.sent_at is not None
    
    # 5. ĞÑ‚Ğ¼ĞµÑ‚ĞºĞ° ĞºĞ°Ğº Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ½Ğ¾Ğµ
    await service.mark_as_read(notification.id)
    await session.refresh(notification)
    assert notification.read_at is not None
```

---

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Rate Limiting

```python
from core.utils.notification_rate_limiter import NotificationRateLimiter

limiter = NotificationRateLimiter()

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¾Ğ¹
if not await limiter.check_limit(user_id, notification_type):
    logger.warning(f"Rate limit exceeded for user {user_id}")
    return False

# Ğ›Ğ¸Ğ¼Ğ¸Ñ‚Ñ‹:
# - 10 ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹/Ñ‡Ğ°Ñ Ğ½Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ¾Ğ±Ñ‹Ñ‡Ğ½Ñ‹Ğµ)
# - Ğ‘ĞµĞ· Ğ»Ğ¸Ğ¼Ğ¸Ñ‚Ğ° Ğ´Ğ»Ñ urgent ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹
```

### Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

```python
# Email
from email_validator import validate_email

def validate_email_address(email: str) -> bool:
    try:
        validate_email(email)
        return True
    except:
        return False

# Ğ¢ĞµĞ»ĞµÑ„Ğ¾Ğ½
import phonenumbers

def validate_phone_number(phone: str) -> bool:
    try:
        parsed = phonenumbers.parse(phone, "RU")
        return phonenumbers.is_valid_number(parsed)
    except:
        return False
```

### ĞÑ‚Ğ¿Ğ¸ÑĞºĞ° Ğ¾Ñ‚ email

```python
# Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ñ‚Ğ¾ĞºĞµĞ½Ğ°
import hashlib
import hmac

def generate_unsubscribe_token(user_id: int, secret: str) -> str:
    data = f"{user_id}:{secret}"
    return hmac.new(secret.encode(), data.encode(), hashlib.sha256).hexdigest()

# Ğ’ email ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ğµ
unsubscribe_url = f"https://staffprobot.ru/unsubscribe/{token}"
```

---

## ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Prometheus

```python
from prometheus_client import Counter, Histogram

notifications_sent = Counter(
    'notifications_sent_total',
    'Total notifications sent',
    ['channel', 'type', 'status']
)

notification_duration = Histogram(
    'notification_send_duration_seconds',
    'Time to send notification',
    ['channel']
)

# Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
with notification_duration.labels(channel='email').time():
    await email_channel.send(notification)
    notifications_sent.labels(channel='email', type='shift', status='sent').inc()
```

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```python
from core.logging.logger import logger

# ĞŸÑ€Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ
logger.info(
    "Notification sent",
    notification_id=notification.id,
    user_id=user_id,
    channel=channel.value,
    type=notification_type.value,
    duration_ms=duration
)

# ĞŸÑ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
logger.error(
    "Failed to send notification",
    notification_id=notification.id,
    channel=channel.value,
    error=str(e)
)
```

---

## ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

### ĞšÑÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```python
from core.cache.redis_cache import cached

class NotificationService:
    @cached(key_prefix="user_notifications", ttl=300)  # 5 Ğ¼Ğ¸Ğ½ÑƒÑ‚
    async def get_user_notifications(self, user_id: int, filters: dict):
        # Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº Ğ‘Ğ”
        pass
    
    @cached(key_prefix="unread_count", ttl=60)  # 1 Ğ¼Ğ¸Ğ½ÑƒÑ‚Ğ°
    async def get_unread_count(self, user_id: int):
        # Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº Ğ‘Ğ”
        pass
```

### Batch Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ°

```python
# Ğ”Ğ»Ñ email
async def send_batch_emails(notifications: List[Notification]):
    """ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¿Ğ°Ñ‡ĞºĞ¸ email Ğ·Ğ° Ğ¾Ğ´Ğ¸Ğ½ SMTP connection."""
    async with EmailChannel() as channel:
        for notification in notifications:
            await channel.send(notification)
```

---

## ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ

### Ğ­Ñ‚Ğ°Ğ¿Ñ‹

1. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹** (Alembic Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ)
2. **Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ NotificationService** (ÑƒĞ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ³Ğ»ÑƒÑˆĞºĞ¸)
3. **Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ĞºĞ°Ğ½Ğ°Ğ»Ñ‹** (Email â†’ SMS â†’ Push)
4. **ĞœĞ¸Ğ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ğµ ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ** (Ğ¸Ğ· ÑÑ‚Ğ°Ñ€Ğ¾Ğ¹ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ‹)
5. **ĞŸĞµÑ€ĞµĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ´** (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ)
6. **Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ€ÑƒÑ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ** (Ğ¿Ğ¾ÑĞ»Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸)

### ĞĞ±Ñ€Ğ°Ñ‚Ğ½Ğ°Ñ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ

```python
# Ğ¡Ñ‚Ğ°Ñ€Ñ‹Ğ¹ ĞºĞ¾Ğ´ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ°ĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· Ğ°Ğ´Ğ°Ğ¿Ñ‚ĞµÑ€
class LegacyNotificationAdapter:
    """ĞĞ´Ğ°Ğ¿Ñ‚ĞµÑ€ Ğ´Ğ»Ñ ÑÑ‚Ğ°Ñ€Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ´Ğ°."""
    
    def __init__(self, new_service: NotificationService):
        self.service = new_service
    
    def create_notification(self, user_id, type, payload):
        # ĞœĞ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³ Ğ½Ğ° Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
        return self.service.create_notification(
            user_id=user_id,
            type=NotificationType(type),
            channel=NotificationChannel.TELEGRAM,  # default
            title=payload.get("title", ""),
            message=payload.get("message", ""),
            data=payload
        )
```

---

## Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ¸Ğ°Ğ»Ñ‹

- [RFC 5322](https://datatracker.ietf.org/doc/html/rfc5322) - Email Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚
- [Web Push Protocol](https://datatracker.ietf.org/doc/html/rfc8030)
- [Twilio API Docs](https://www.twilio.com/docs/sms)
- [PyWebPush](https://github.com/web-push-libs/pywebpush)


