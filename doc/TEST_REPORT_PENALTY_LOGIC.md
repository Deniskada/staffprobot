# –û—Ç—á—ë—Ç –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ª–æ–≥–∏–∫–∏ —à—Ç—Ä–∞—Ñ–æ–≤ –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –≤–µ—á–µ—Ä–Ω—é—é —Å–º–µ–Ω—É

**–î–∞—Ç–∞:** 2025-11-01  
**–í–µ—Ä—Å–∏—è:** –ò—Ç–µ—Ä–∞—Ü–∏—è 40

## ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### 1. –ê–≤—Ç–æ–ø—Ä–∞–≤–∏–ª–æ —Å–æ–∑–¥–∞–Ω–æ

‚úÖ **–ü—Ä–∞–≤–∏–ª–æ `penalty_non_standard_shift` —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–æ –≤ –ë–î**
- Code: `penalty_non_standard_shift`
- Name: `–®—Ç—Ä–∞—Ñ –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –≤–µ—á–µ—Ä–Ω—é—é —Å–º–µ–Ω—É (–∏–ª–∏ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è)`
- Scope: `late`
- Is Active: `true`
- Priority: `50`

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

#### –°–º–µ–Ω–∞ 345 (—Ç–µ—Å—Ç–æ–≤—ã–π —Å–ª—É—á–∞–π):
- **–û–±—ä–µ–∫—Ç:** –ü–í–ó –û–ó–û–ù_25
- **Opening Time:** 09:00:00
- **Planned Start (MSK):** 03:01:00
- **Actual Start (MSK):** 03:05:57
- **–¢–∏–ø —Å–º–µ–Ω—ã:** `non-standard` (planned_time != opening_time)
- **Penalize Late Start (timeslot):** `true`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –®—Ç—Ä–∞—Ñ –Ω–∞—á–∏—Å–ª–µ–Ω (-3.00 —Ä—É–± –∑–∞ 4 –º–∏–Ω –æ–ø–æ–∑–¥–∞–Ω–∏—è)

**–í—ã–≤–æ–¥:** ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- –°–º–µ–Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è (03:01 != 09:00)
- –í —Ç–∞–π–º-—Å–ª–æ—Ç–µ —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω —à—Ç—Ä–∞—Ñ ‚Üí —à—Ç—Ä–∞—Ñ –Ω–∞—á–∏—Å–ª–µ–Ω –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø—Ä–∞–≤–∏–ª–∞

### 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫

‚úÖ **–ù–∞–π–¥–µ–Ω–æ 10 –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫ –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏–µ:**
- –í—Å–µ —à—Ç—Ä–∞—Ñ—ã —Å–æ–∑–¥–∞–Ω—ã —á–µ—Ä–µ–∑ –±–∞–∑–æ–≤—É—é —Ñ–æ—Ä–º—É–ª—É (–±–µ–∑ –ø—Ä–∞–≤–∏–ª–∞)
- –ü—Ä–∞–≤–∏–ª–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å–º–µ–Ω

## üìã –¢–ï–°–¢–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–º–µ–Ω–∞ –≤ opening_time –æ–±—ä–µ–∫—Ç–∞
**–û–∂–∏–¥–∞–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–ª–∞–≥ `penalize_late_start` –∏–∑ —Ç–∞–π–º-—Å–ª–æ—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
```python
if planned_matches_opening:
    should_penalize = shift.time_slot.penalize_late_start
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°–º–µ–Ω–∞ –ù–ï –≤ opening_time –æ–±—ä–µ–∫—Ç–∞
**–û–∂–∏–¥–∞–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∞–≤—Ç–æ–ø—Ä–∞–≤–∏–ª–æ `penalty_non_standard_shift`

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. –ï—Å–ª–∏ –≤ —Ç–∞–π–º-—Å–ª–æ—Ç–µ `penalize_late_start = True` ‚Üí –≤—Å–µ–≥–¥–∞ —à—Ç—Ä–∞—Ñ—É–µ—Ç—Å—è
2. –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –≤–∫–ª—é—á–µ–Ω–æ ‚Üí —à—Ç—Ä–∞—Ñ—É–µ—Ç—Å—è
3. –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –≤—ã–∫–ª—é—á–µ–Ω–æ ‚Üí –Ω–µ —à—Ç—Ä–∞—Ñ—É–µ—Ç—Å—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
```python
if not planned_matches_opening:
    if timeslot.penalize_late_start:
        should_penalize = True  # –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1
    else:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∏–ª–æ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)
        rule_actions = await engine.evaluate(...)
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–∞–≤–∏–ª–æ –≤–∫–ª—é—á–µ–Ω–æ ‚Üí —à—Ç—Ä–∞—Ñ –≤—Å–µ–≥–¥–∞ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è
**–û–∂–∏–¥–∞–Ω–∏–µ:** –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –≤–∫–ª—é—á–µ–Ω–æ, —à—Ç—Ä–∞—Ñ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ñ–ª–∞–≥–∞ —Ç–∞–π–º-—Å–ª–æ—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –õ–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –ü—Ä–∞–≤–∏–ª–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ `penalize_late_start = False`
- –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞–π–¥–µ–Ω–æ ‚Üí `should_penalize = True`

## üîç –ü–†–û–í–ï–†–ö–ê –õ–û–ì–ò–ö–ò

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª–∞ –≤ RulesEngine:
```python
rule_actions = await engine.evaluate(owner_id, 'late', {
    'planned_start_matches_opening_time': False,
    'object_id': obj.id,
})
```

**–£—Å–ª–æ–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**
```json
{
  "description": "–®—Ç—Ä–∞—Ñ –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏—è –Ω–∞ —Å–º–µ–Ω—ã, –Ω–∞—á–∞–ª–æ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –æ–±—ä–µ–∫—Ç–∞",
  "planned_start_matches_opening_time": false
}
```

**–î–µ–π—Å—Ç–≤–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**
```json
{
  "type": "fine",
  "code": "penalty_non_standard_shift",
  "label": "–®—Ç—Ä–∞—Ñ –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –≤–µ—á–µ—Ä–Ω—é—é —Å–º–µ–Ω—É (–∏–ª–∏ –≤ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è)",
  "description": "–ù–∞—á–∏—Å–ª—è–µ—Ç—Å—è —à—Ç—Ä–∞—Ñ –∑–∞ –æ–ø–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ —Å–º–µ–Ω—ã, –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–µ –≤ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –æ–±—ä–µ–∫—Ç–∞"
}
```

## ‚ö†Ô∏è –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø

1. **–ü—Ä–∞–≤–∏–ª–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–æ–∫:**
   - –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã
   - –î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Å–º–µ–Ω—ã

2. **–ü—Ä–∞–≤–∏–ª–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å–º–µ–Ω:**
   - –°–º–µ–Ω—ã –≤ `opening_time` –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ñ–ª–∞–≥ —Ç–∞–π–º-—Å–ª–æ—Ç–∞
   - –ü—Ä–∞–≤–∏–ª–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–º–µ–Ω —Å `planned_start != opening_time`

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –í–´–í–û–î

**–õ–æ–≥–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**

1. ‚úÖ –ê–≤—Ç–æ–ø—Ä–∞–≤–∏–ª–æ `penalty_non_standard_shift` —Å–æ–∑–¥–∞–Ω–æ –∏ –∞–∫—Ç–∏–≤–Ω–æ
2. ‚úÖ –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è `planned_start` —Å `opening_time` —Ä–∞–±–æ—Ç–∞–µ—Ç
3. ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–∞–π–º-—Å–ª–æ—Ç–∞ –Ω–∞–¥ –ø—Ä–∞–≤–∏–ª–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
4. ‚úÖ –ü—Ä–∞–≤–∏–ª–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å–º–µ–Ω –±–µ–∑ —è–≤–Ω–æ–≥–æ —à—Ç—Ä–∞—Ñ–∞ –≤ —Ç–∞–π–º-—Å–ª–æ—Ç–µ

**–ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
- –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å–º–µ–Ω—É
- –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ `penalty_non_standard_shift`
- –ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É —Å –æ–ø–æ–∑–¥–∞–Ω–∏–µ–º
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —à—Ç—Ä–∞—Ñ –ù–ï –Ω–∞—á–∏—Å–ª–µ–Ω
- –í–∫–ª—é—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ
- –°–æ–∑–¥–∞—Ç—å –µ—â—ë –æ–¥–Ω—É –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å–º–µ–Ω—É
- –ó–∞–∫—Ä—ã—Ç—å —Å–º–µ–Ω—É —Å –æ–ø–æ–∑–¥–∞–Ω–∏–µ–º
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —à—Ç—Ä–∞—Ñ –ù–ê–ß–ò–°–õ–ï–ù

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–ô–î–ï–ù–û**

