<!-- Shared Timeslot Component -->
<div class="timeslot-item timeslot-{{ timeslot.status }}" 
     data-timeslot-id="{{ timeslot.id }}"
     data-object-id="{{ timeslot.object_id }}"
     data-date="{{ timeslot.date }}"
     data-start-time="{{ timeslot.start_time }}"
     data-end-time="{{ timeslot.end_time }}"
     data-max-employees="{{ timeslot.max_employees }}"
     data-current-employees="{{ timeslot.current_employees }}"
     data-available-slots="{{ timeslot.available_slots }}">
    
    <div class="timeslot-header">
        <div class="timeslot-time">
            <i class="bi bi-clock"></i>
            {{ timeslot.start_time }} - {{ timeslot.end_time }}
        </div>
        <div class="timeslot-status">
            <span class="badge badge-{{ timeslot.status }}">{{ timeslot.status|title }}</span>
        </div>
        <div class="timeslot-rate">
            <i class="bi bi-currency-dollar"></i>
            {{ timeslot.hourly_rate }}₽/час
        </div>
    </div>
    
    <div class="timeslot-content">
        <div class="timeslot-object">
            <i class="bi bi-geo-alt"></i>
            {{ timeslot.object_name }}
        </div>
        
        {% if timeslot.work_conditions %}
        <div class="timeslot-conditions">
            <i class="bi bi-info-circle"></i>
            {{ timeslot.work_conditions }}
        </div>
        {% endif %}
        
        {% if timeslot.shift_tasks %}
        <div class="timeslot-tasks">
            <i class="bi bi-list-task"></i>
            <span class="task-count">{{ timeslot.shift_tasks|length }} задач</span>
        </div>
        {% endif %}
        
        <div class="timeslot-employees">
            <i class="bi bi-people"></i>
            <span class="employee-count">{{ timeslot.current_employees }}/{{ timeslot.max_employees }} сотрудников</span>
        </div>
        
        {% if timeslot.available_slots > 0 %}
        <div class="timeslot-availability">
            <i class="bi bi-check-circle text-success"></i>
            <span class="available-slots">{{ timeslot.available_slots }} свободных мест</span>
        </div>
        {% else %}
        <div class="timeslot-availability">
            <i class="bi bi-x-circle text-danger"></i>
            <span class="no-slots">Нет свободных мест</span>
        </div>
        {% endif %}
    </div>
    
    <div class="timeslot-actions">
        {% if timeslot.can_edit %}
        <button type="button" class="btn btn-sm btn-outline-primary" onclick="editTimeslot({{ timeslot.id }})">
            <i class="bi bi-pencil"></i> Редактировать
        </button>
        {% endif %}
        
        {% if timeslot.can_plan %}
        <button type="button" class="btn btn-sm btn-outline-success" onclick="planShift({{ timeslot.id }})">
            <i class="bi bi-calendar-plus"></i> Запланировать
        </button>
        {% endif %}
        
        {% if timeslot.can_view %}
        <button type="button" class="btn btn-sm btn-outline-info" onclick="viewTimeslot({{ timeslot.id }})">
            <i class="bi bi-eye"></i> Подробнее
        </button>
        {% endif %}
    </div>
    
    <!-- Occupancy Indicator -->
    <div class="timeslot-occupancy" 
         data-timeslot-id="{{ timeslot.id }}"
         data-max-employees="{{ timeslot.max_employees }}"
         data-current-employees="{{ timeslot.current_employees }}"
         data-available-slots="{{ timeslot.available_slots }}">
        <span class="occupancy-text">{{ timeslot.current_employees }}/{{ timeslot.max_employees }}</span>
        {% if timeslot.available_slots == 0 %}
        <span class="occupancy-full">Полностью занят</span>
        {% endif %}
    </div>
</div>

<!-- Timeslot JavaScript -->
<script>
function editTimeslot(timeslotId) {
    // This will be implemented by the parent template
    if (typeof window.editTimeslot === 'function') {
        window.editTimeslot(timeslotId);
    }
}

function planShift(timeslotId) {
    // This will be implemented by the parent template
    if (typeof window.planShift === 'function') {
        window.planShift(timeslotId);
    }
}

function viewTimeslot(timeslotId) {
    // This will be implemented by the parent template
    if (typeof window.viewTimeslot === 'function') {
        window.viewTimeslot(timeslotId);
    }
}

// Update occupancy indicator
function updateTimeslotOccupancy(timeslotId, currentEmployees, maxEmployees) {
    const occupancyElement = document.querySelector(`[data-timeslot-id="${timeslotId}"] .timeslot-occupancy`);
    if (occupancyElement) {
        const occupancyText = occupancyElement.querySelector('.occupancy-text');
        if (occupancyText) {
            occupancyText.textContent = `${currentEmployees}/${maxEmployees}`;
        }
        
        const availableSlots = maxEmployees - currentEmployees;
        const availabilityElement = occupancyElement.closest('.timeslot-item').querySelector('.timeslot-availability');
        if (availabilityElement) {
            if (availableSlots > 0) {
                availabilityElement.innerHTML = `
                    <i class="bi bi-check-circle text-success"></i>
                    <span class="available-slots">${availableSlots} свободных мест</span>
                `;
            } else {
                availabilityElement.innerHTML = `
                    <i class="bi bi-x-circle text-danger"></i>
                    <span class="no-slots">Нет свободных мест</span>
                `;
            }
        }
    }
}
</script>
