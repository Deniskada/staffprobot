{% extends "employee/base_employee.html" %}

{% block title %}StaffProBot - Поиск работы{% endblock %}

{% block extra_css %}
<link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0">
                <i class="bi bi-geo-alt text-primary"></i>
                Поиск работы
            </h1>
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary active" id="view-map">
                    <i class="bi bi-map"></i> Карта
                </button>
                <button type="button" class="btn btn-outline-primary" id="view-list">
                    <i class="bi bi-list"></i> Список
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Фильтры -->
<div class="row mb-4">
    <div class="col-12">
        <div class="filter-panel">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">Тип работы</label>
                    <select class="form-select" id="work-type-filter">
                        <option value="">Все типы</option>
                        <option value="cleaning">Уборка и санитария</option>
                        <option value="service">Обслуживание клиентов</option>
                        <option value="security">Безопасность</option>
                        <option value="technical">Техническое обслуживание</option>
                        <option value="admin">Административные задачи</option>
                        <option value="sales">Продажи и маркетинг</option>
                        <option value="warehouse">Складские операции</option>
                        <option value="specialized">Специализированные задачи</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">График работы</label>
                    <select class="form-select" id="schedule-filter">
                        <option value="">Любой график</option>
                        <option value="full-time">Полный день</option>
                        <option value="part-time">Неполный день</option>
                        <option value="shift">Сменный график</option>
                        <option value="flexible">Гибкий график</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Опыт работы</label>
                    <select class="form-select" id="experience-filter">
                        <option value="">Любой опыт</option>
                        <option value="no-experience">Без опыта</option>
                        <option value="1-year">До 1 года</option>
                        <option value="1-3-years">1-3 года</option>
                        <option value="3-years">Более 3 лет</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Зарплата от</label>
                    <select class="form-select" id="salary-filter">
                        <option value="">Любая зарплата</option>
                        <option value="50000">50 000 ₽</option>
                        <option value="75000">75 000 ₽</option>
                        <option value="100000">100 000 ₽</option>
                        <option value="150000">150 000 ₽</option>
                        <option value="200000">200 000 ₽</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label class="form-label">Удаленность</label>
                    <select class="form-select" id="distance-filter">
                        <option value="">Любое расстояние</option>
                        <option value="1">До 1 км</option>
                        <option value="3">До 3 км</option>
                        <option value="5">До 5 км</option>
                        <option value="10">До 10 км</option>
                        <option value="20">До 20 км</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Транспорт</label>
                    <select class="form-select" id="transport-filter">
                        <option value="">Любой транспорт</option>
                        <option value="walking">Пешком</option>
                        <option value="public">Общественный</option>
                        <option value="car">На автомобиле</option>
                        <option value="bike">На велосипеде</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label">Гибкость</label>
                    <select class="form-select" id="flexibility-filter">
                        <option value="">Любая гибкость</option>
                        <option value="strict">Строгий график</option>
                        <option value="moderate">Умеренная гибкость</option>
                        <option value="high">Высокая гибкость</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3 d-flex align-items-end">
                    <button type="button" class="btn btn-primary w-100" id="apply-filters">
                        <i class="bi bi-funnel"></i> Применить фильтры
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Карта -->
<div class="row" id="map-view">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-map"></i> Карта доступных объектов
                </h5>
            </div>
            <div class="card-body p-0">
                <div id="map" class="map-container"></div>
            </div>
        </div>
    </div>
</div>

<!-- Список объектов -->
<div class="row d-none" id="list-view">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="bi bi-list"></i> Список доступных объектов
                </h5>
                <span class="badge bg-primary" id="objects-count">{{ objects|length }} объектов</span>
            </div>
            <div class="card-body">
                <div class="row" id="objects-list">
                    {% for object in objects %}
                    <div class="col-md-6 col-lg-4 mb-3 object-item" data-object-id="{{ object.id }}">
                        <div class="object-card card h-100">
                            <div class="card-header">
                                <h6 class="mb-0">{{ object.name }}</h6>
                            </div>
                            <div class="card-body">
                                <p class="card-text">
                                    <i class="bi bi-geo-alt"></i> {{ object.address }}
                                </p>
                                <p class="card-text">
                                    <i class="bi bi-clock"></i> {{ object.opening_time }} - {{ object.closing_time }}
                                </p>
                                <p class="card-text">
                                    <i class="bi bi-currency-ruble"></i> {{ object.hourly_rate }} ₽/час
                                </p>
                                {% if object.work_conditions %}
                                <p class="card-text">
                                    <small class="text-muted">{{ object.work_conditions[:100] }}{% if object.work_conditions|length > 100 %}...{% endif %}</small>
                                </p>
                                {% endif %}
                                <div class="mt-3">
                                    {% for category in object.shift_tasks %}
                                    <span class="badge bg-secondary me-1">{{ category }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="card-footer">
                                <button class="btn btn-primary btn-action w-100 apply-btn" data-object-id="{{ object.id }}">
                                    <i class="bi bi-file-text"></i> Подать заявку
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Модальное окно подачи заявки -->
<div class="modal fade" id="applicationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="bi bi-file-text"></i> Подача заявки на работу
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="application-form">
                    <input type="hidden" id="object-id" name="object_id">
                    
                    <div class="mb-3">
                        <label class="form-label">Объект</label>
                        <input type="text" class="form-control" id="object-name" readonly>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Условия работы</label>
                        <textarea class="form-control" id="work-conditions" rows="3" readonly></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Задачи на смене</label>
                        <div id="shift-tasks-list"></div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Ваше сообщение работодателю</label>
                        <textarea class="form-control" name="message" rows="4" placeholder="Расскажите о себе, своем опыте и почему вы хотите работать на этом объекте..."></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Предпочитаемый график работы</label>
                        <select class="form-select" name="preferred_schedule">
                            <option value="">Выберите график</option>
                            <option value="full-time">Полный день</option>
                            <option value="part-time">Неполный день</option>
                            <option value="shift">Сменный график</option>
                            <option value="flexible">Гибкий график</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Отмена</button>
                <button type="button" class="btn btn-primary" id="submit-application">
                    <i class="bi bi-send"></i> Подать заявку
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<script src="/static/js/employee/objects.js"></script>
{% endblock %}
