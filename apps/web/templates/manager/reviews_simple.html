{% extends "manager/base_manager.html" %}

{% block title %}–û—Ç–∑—ã–≤—ã –∏ —Ä–µ–π—Ç–∏–Ω–≥–∏ - StaffProBot{% endblock %}

{% block manager_content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1><i class="fas fa-comments"></i> –û—Ç–∑—ã–≤—ã</h1>
            
            <!-- –ü—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-body text-center">
                            <h3 id="total-reviews">-</h3>
                            <p>–í—Å–µ–≥–æ –æ—Ç–∑—ã–≤–æ–≤</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—Ç–∑—ã–≤–æ–≤ -->
            <div id="reviews-container">
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    </div>
                    <p class="mt-3">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤...</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
console.log('üöÄ JavaScript –∑–∞–≥—Ä—É–∂–µ–Ω!');

// –ü—Ä–æ—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤
async function loadReviews() {
    console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã...');
    try {
        const response = await fetch('/api/reviews/my-reviews');
        console.log('üì° Response status:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        console.log('üì¶ Response data:', data);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        document.getElementById('total-reviews').textContent = data.count || 0;
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        const container = document.getElementById('reviews-container');
        if (data.reviews && data.reviews.length > 0) {
            container.innerHTML = '<div class="alert alert-success">‚úÖ –ù–∞–π–¥–µ–Ω–æ –æ—Ç–∑—ã–≤–æ–≤: ' + data.reviews.length + '</div>';
        } else {
            container.innerHTML = '<div class="alert alert-info">‚ÑπÔ∏è –û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>';
        }
        
        console.log('‚úÖ –û—Ç–∑—ã–≤—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ');
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤:', error);
        document.getElementById('reviews-container').innerHTML = 
            '<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</div>';
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ DOM
document.addEventListener('DOMContentLoaded', function() {
    console.log('üéØ DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –æ—Ç–∑—ã–≤–æ–≤...');
    loadReviews();
});
</script>
{% endblock %}
