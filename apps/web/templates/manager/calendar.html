{% extends "manager/base_manager.html" %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', path='css/shared/calendar.css') }}">
{% endblock %}

{% block manager_content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            {% include 'shared/calendar/objects_panel.html' %}
            {% include 'shared/calendar/employees_panel.html' %}
            {% include 'shared/calendar/quick_create_form.html' %}
            {% include 'shared/calendar/grid.html' %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Calendar Panels -->
<script src="{{ url_for('static', path='js/shared/calendar_panels.js') }}"></script>
<!-- Universal Calendar Integration -->
<script src="{{ url_for('static', path='js/shared/universal_calendar.js') }}"></script>
<script>
    // Инициализация универсального календаря для управляющего
    document.addEventListener('DOMContentLoaded', function() {
        // Инициализируем панели drag&drop
        if (typeof CalendarPanels !== 'undefined') {
            window.calendarPanels = new CalendarPanels('manager');
            window.calendarPanels.init();
        }
        
        // Создаем экземпляр универсального календаря
        if (typeof UniversalCalendarManager !== 'undefined') {
            window.universalCalendar = new UniversalCalendarManager({
                currentDate: new Date({{ year }}, {{ month - 1 }}, 1),
                viewType: 'month',
                baseUrl: '/manager/calendar',
                userRole: 'manager',
                apiEndpoint: '/manager/calendar/api/data',
                onShiftClick: function(shiftId) {
                    console.log('Shift clicked:', shiftId);
                    if (shiftId.toString().startsWith('schedule_')) {
                        const scheduleId = shiftId.toString().replace('schedule_', '');
                        window.location.href = `/manager/shifts/${scheduleId}?shift_type=schedule`;
                    } else {
                        window.location.href = `/manager/shifts/${shiftId}?shift_type=shift`;
                    }
                },
                onTimeslotClick: function(timeslotId) {
                    console.log('Timeslot clicked:', timeslotId);
                    window.location.href = `/manager/timeslots/${timeslotId}`;
                },
                onDataLoaded: function(calendarData) {
                    console.log('Manager calendar data loaded:', calendarData);
                    // Обновляем отображение с новыми данными
                    if (typeof window.renderCalendarGrid === 'function') {
                        window.renderCalendarGrid(calendarData);
                    }
                }
            });
        }
    });

</script>
{% endblock %}