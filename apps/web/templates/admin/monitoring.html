{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
.monitoring-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
    margin-bottom: 20px;
}

.monitoring-card:hover {
    transform: translateY(-3px);
}

.system-status {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 30px;
}

.status-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.status-item:last-child {
    border-bottom: none;
}

.status-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
}

.status-online {
    background-color: #28a745;
    box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
}

.status-warning {
    background-color: #ffc107;
    box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
}

.status-offline {
    background-color: #dc3545;
    box-shadow: 0 0 10px rgba(220, 53, 69, 0.5);
}

.metric-card {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    margin-bottom: 20px;
}

.metric-value {
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.metric-label {
    font-size: 0.9rem;
    opacity: 0.9;
}

.external-link {
    display: inline-block;
    background: rgba(255,255,255,0.2);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    text-decoration: none;
    margin: 5px;
    transition: all 0.3s ease;
}

.external-link:hover {
    background: rgba(255,255,255,0.3);
    color: white;
    text-decoration: none;
    transform: scale(1.05);
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã</h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a href="{{ url_for('admin_dashboard') }}">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</a>
                    </li>
                    <li class="breadcrumb-item active">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</li>
                </ol>
            </nav>
        </div>
        <div>
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">
                ‚Üê –ù–∞–∑–∞–¥ –∫ –ø–∞–Ω–µ–ª–∏
            </a>
        </div>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã -->
    <div class="system-status">
        <h3 class="mb-4">‚öôÔ∏è –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã</h3>
        
        <div class="status-item">
            <div>
                <span class="status-indicator status-online"></span>
                <strong>FastAPI Web Server</strong>
            </div>
            <span class="badge badge-success">–†–∞–±–æ—Ç–∞–µ—Ç</span>
        </div>

        <div class="status-item">
            <div>
                <span class="status-indicator status-online"></span>
                <strong>PostgreSQL Database</strong>
            </div>
            <span class="badge badge-success">–ü–æ–¥–∫–ª—é—á–µ–Ω–∞</span>
        </div>

        <div class="status-item">
            <div>
                <span class="status-indicator status-online"></span>
                <strong>Redis Cache</strong>
            </div>
            <span class="badge badge-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
        </div>

        <div class="status-item">
            <div>
                <span class="status-indicator status-online"></span>
                <strong>Telegram Bot</strong>
            </div>
            <span class="badge badge-success">–û–Ω–ª–∞–π–Ω</span>
        </div>

        <div class="status-item">
            <div>
                <span class="status-indicator status-online"></span>
                <strong>Prometheus Metrics</strong>
            </div>
            <span class="badge badge-success">–°–æ–±–∏—Ä–∞—é—Ç—Å—è</span>
        </div>

        <div class="status-item">
            <div>
                <span class="status-indicator status-online"></span>
                <strong>Grafana Dashboard</strong>
            </div>
            <span class="badge badge-success">–î–æ—Å—Ç—É–ø–µ–Ω</span>
        </div>
    </div>

    <!-- –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card monitoring-card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">üîó –í–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</h5>
                </div>
                <div class="card-body text-center">
                    <a href="{{ prometheus_url }}" target="_blank" class="external-link">
                        üìà Prometheus ({{ prometheus_url }})
                    </a>
                    <a href="{{ grafana_url }}" target="_blank" class="external-link">
                        üìä Grafana ({{ grafana_url }})
                    </a>
                    <a href="http://localhost:15672" target="_blank" class="external-link">
                        üê∞ RabbitMQ Management
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ -->
    <div class="row">
        <div class="col-md-3">
            <div class="metric-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <div class="metric-value" id="cpu-usage">--</div>
                <div class="metric-label">CPU Usage</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                <div class="metric-value" id="memory-usage">--</div>
                <div class="metric-label">Memory Usage</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="metric-value" id="active-connections">--</div>
                <div class="metric-label">DB Connections</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="metric-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="metric-value" id="cache-hit-rate">--</div>
                <div class="metric-label">Cache Hit Rate</div>
            </div>
        </div>
    </div>

    <!-- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card monitoring-card">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è</h5>
                </div>
                <div class="card-body">
                    <div id="system-logs">
                        <div class="text-center text-muted py-3">
                            <div class="spinner-border spinner-border-sm" role="status">
                                <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            </div>
                            –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card monitoring-card">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">üö® –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏</h5>
                </div>
                <div class="card-body">
                    <div id="error-logs">
                        <div class="text-center text-muted py-3">
                            <div class="spinner-border spinner-border-sm" role="status">
                                <span class="sr-only">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            </div>
                            –ó–∞–≥—Ä—É–∑–∫–∞ –æ—à–∏–±–æ–∫...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–±–æ—Ä–∫–µ -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card monitoring-card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><strong>–í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</strong> 1.0.0</li>
                                <li><strong>–û–∫—Ä—É–∂–µ–Ω–∏–µ:</strong> Development</li>
                                <li><strong>Python –≤–µ—Ä—Å–∏—è:</strong> 3.11+</li>
                                <li><strong>FastAPI –≤–µ—Ä—Å–∏—è:</strong> Latest</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><strong>–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:</strong> PostgreSQL 15</li>
                                <li><strong>–ö—ç—à:</strong> Redis 7</li>
                                <li><strong>–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:</strong> Docker</li>
                                <li><strong>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> <span id="uptime">--</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –°–∏–º—É–ª—è—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
function updateMetrics() {
    // –°–∏–º—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –∑–¥–µ—Å—å –±—É–¥—É—Ç AJAX –∑–∞–ø—Ä–æ—Å—ã –∫ API)
    document.getElementById('cpu-usage').textContent = (Math.random() * 30 + 20).toFixed(1) + '%';
    document.getElementById('memory-usage').textContent = (Math.random() * 40 + 40).toFixed(1) + '%';
    document.getElementById('active-connections').textContent = Math.floor(Math.random() * 10 + 5);
    document.getElementById('cache-hit-rate').textContent = (Math.random() * 20 + 75).toFixed(1) + '%';
}

// –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤
function loadSystemLogs() {
    const logsContainer = document.getElementById('system-logs');
    const errorLogsContainer = document.getElementById('error-logs');
    
    // –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏
    logsContainer.innerHTML = `
        <div class="small">
            <div class="mb-1"><span class="text-success">[INFO]</span> 2024-01-15 10:30:15 - User login successful</div>
            <div class="mb-1"><span class="text-info">[DEBUG]</span> 2024-01-15 10:29:42 - Database query executed</div>
            <div class="mb-1"><span class="text-success">[INFO]</span> 2024-01-15 10:28:33 - Shift created successfully</div>
            <div class="mb-1"><span class="text-info">[DEBUG]</span> 2024-01-15 10:27:15 - Cache hit for user data</div>
            <div class="mb-1"><span class="text-success">[INFO]</span> 2024-01-15 10:26:01 - Bot message sent</div>
        </div>
    `;
    
    // –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
    errorLogsContainer.innerHTML = `
        <div class="small">
            <div class="mb-1"><span class="text-warning">[WARN]</span> 2024-01-15 10:25:12 - Slow query detected</div>
            <div class="mb-1"><span class="text-danger">[ERROR]</span> 2024-01-15 10:20:33 - Failed to send notification</div>
            <div class="mb-1"><span class="text-warning">[WARN]</span> 2024-01-15 10:15:45 - High memory usage</div>
            <div class="mb-1"><span class="text-danger">[ERROR]</span> 2024-01-15 10:10:22 - Database connection timeout</div>
        </div>
    `;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–±–æ—Ç—ã
function updateUptime() {
    const startTime = new Date('2024-01-15T08:00:00');
    const now = new Date();
    const uptime = Math.floor((now - startTime) / 1000);
    
    const hours = Math.floor(uptime / 3600);
    const minutes = Math.floor((uptime % 3600) / 60);
    
    document.getElementById('uptime').textContent = `${hours}—á ${minutes}–º`;
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    updateMetrics();
    loadSystemLogs();
    updateUptime();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
    setInterval(updateMetrics, 5000);
    setInterval(updateUptime, 60000);
});
</script>
{% endblock %}
