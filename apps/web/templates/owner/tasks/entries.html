{% extends "owner/base_owner.html" %}
{% block title %}Выполнение задач{% endblock %}
{% block content %}
<div class="container mt-4">
  <h2>Выполнение и аудит задач</h2>
  <p class="text-muted">История выполнения задач сотрудниками.</p>
  
  <table class="table table-sm table-hover">
    <thead>
      <tr>
        <th>ID</th>
        <th>Шаблон</th>
        <th>Объект</th>
        <th>Смена</th>
        <th>Сотрудник</th>
        <th>Выполнено</th>
        <th>Начисление</th>
        <th>Заметки</th>
        <th>Дата</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
    {% for e in entries %}
      <tr class="{{ 'table-success' if e.is_completed else '' }}">
        <td>{{ e.id }}</td>
        <td>
          {{ e.template.title if e.template else e.template_id }}
          {% if e.template and e.template.is_mandatory %}
            <span class="badge bg-danger ms-1">Обязательная</span>
          {% endif %}
        </td>
        <td>{{ e.plan.object.name if e.plan and e.plan.object else '—' }}</td>
        <td>{{ e.shift_schedule_id or '—' }}</td>
        <td>
          {% if e.employee %}
            {{ e.employee.last_name }} {{ e.employee.first_name }}
          {% else %}
            {{ e.employee_id or '—' }}
          {% endif %}
        </td>
        <td>
          <span class="badge {{ 'bg-success' if e.is_completed else 'bg-warning' }}">
            {{ 'Выполнено' if e.is_completed else 'Не выполнено' }}
          </span>
        </td>
        <td>
          {% if e.template and e.template.default_bonus_amount %}
            {{ e.template.default_bonus_amount }} ₽
          {% else %}
            —
          {% endif %}
        </td>
        <td>{{ e.notes[:40] if e.notes else '—' }}</td>
        <td>{{ e.created_at.strftime('%d.%m.%Y %H:%M') if e.created_at else '—' }}</td>
        <td>
          {% if not e.is_completed %}
            <form method="post" action="/owner/tasks/entries/{{ e.id }}/complete" class="d-inline">
              <button type="submit" class="btn btn-sm btn-success" title="Отметить выполненной">
                <i class="fas fa-check"></i>
              </button>
            </form>
          {% else %}
            <span class="text-muted"><i class="fas fa-check-circle"></i></span>
          {% endif %}
        </td>
      </tr>
    {% else %}
      <tr><td colspan="10" class="text-center text-muted">Нет записей выполнения задач.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

