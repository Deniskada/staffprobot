# OpenSpec: Руководство по использованию

## Структура OpenSpec

```
openspec/
├── specs/                    # Источник истины — спецификации
│   └── [capability]/         # Каждая возможность в своей папке
│       └── spec.md          # Спецификация возможности
└── changes/                  # Активные предложения изменений
    └── [change-id]/          # Каждое изменение в своей папке
        ├── proposal.md       # Описание изменения
        ├── design.md         # Технические решения
        ├── tasks.md          # Задачи реализации
        └── specs/            # Дельта спецификаций
            └── [capability]/
                └── spec.md
```

## Workflow изменений

### 1. Draft (Черновик)
Создайте предложение в `changes/[change-id]/proposal.md`:

```markdown
# [Название изменения]

## Описание
[Что нужно изменить и зачем]

## Цель
[Какую проблему решает]

## Затронутые возможности
- [capability-1]
- [capability-2]
```

### 2. Review (Обсуждение)
- Обсудите предложение с командой
- Дополните `design.md` техническими решениями
- Создайте `tasks.md` с задачами реализации

### 3. Implement (Реализация)
- Реализуйте согласно спецификациям
- Обновляйте `tasks.md` по мере выполнения
- Следуйте `design.md` для технических решений

### 4. Complete (Завершение)
- Обновите спецификации в `specs/[capability]/spec.md`
- Примените дельты из `changes/[change-id]/specs/`
- Переместите изменение в архив

### 5. Archive (Архив)
- Переместите завершённое изменение в архив
- Обновите связанные спецификации

## Формат спецификации

```markdown
# [Название возможности] Specification

## Purpose
[Зачем существует эта возможность]

## Requirements

### Requirement: [Название требования]
[Описание требования]

#### Scenario: [Название сценария]
- GIVEN [предусловие]
- WHEN [действие]
- THEN [ожидаемый результат]
- AND [дополнительный результат]
```

## Примеры

### Создание новой спецификации

1. Создайте папку в `specs/`:
   ```bash
   mkdir -p openspec/specs/user-registration
   ```

2. Создайте `spec.md`:
   ```markdown
   # User Registration Specification

   ## Purpose
   Позволить пользователям регистрироваться в системе через Telegram или веб-интерфейс.

   ## Requirements

   ### Requirement: Валидация email
   При регистрации должен проверяться email на корректность.

   #### Scenario: Успешная регистрация с валидным email
   - GIVEN пользователь открыл форму регистрации
   - WHEN пользователь вводит валидный email и сохраняет
   - THEN пользователь регистрируется успешно
   - AND email сохраняется в базе данных

   #### Scenario: Ошибка при невалидном email
   - GIVEN пользователь открыл форму регистрации
   - WHEN пользователь вводит невалидный email и сохраняет
   - THEN отображается сообщение об ошибке
   - AND пользователь не регистрируется
   ```

### Создание предложения изменения

1. Создайте папку в `changes/`:
   ```bash
   mkdir -p openspec/changes/2026-02-07-add-email-validation
   ```

2. Создайте `proposal.md`:
   ```markdown
   # Добавить валидацию email при регистрации

   ## Описание
   Добавить валидацию email при регистрации для предотвращения ошибок.

   ## Цель
   Улучшить качество данных в системе.

   ## Затронутые возможности
   - user-registration
   ```

3. Создайте `design.md`:
   ```markdown
   # Технический дизайн: Валидация email

   ## Решение
   Использовать Pydantic email validator.

   ## Реализация
   - Добавить валидацию в Pydantic модель User
   - Вывести сообщение об ошибке при невалидном email
   ```

4. Создайте `tasks.md`:
   ```markdown
   # Задачи реализации

   - [ ] Добавить email validator в Pydantic модель
   - [ ] Добавить обработку ошибок валидации
   - [ ] Протестировать с валидным и невалидным email
   ```

## Интеграция с Memory Bank

OpenSpec работает вместе с Cursor Memory Bank:

- **OpenSpec** — для спецификаций требований
- **Memory Bank** — для workflow и контекста разработки

При работе:
1. Читайте спецификации из `openspec/specs/` перед реализацией
2. Используйте Memory Bank команды (`/van`, `/plan`, `/build`) для workflow
3. Обновляйте спецификации после завершения изменений

## Роли и использование

| Роль | Использование OpenSpec |
|------|----------------------|
| **Аналитик** | Создаёт/обновляет спецификации в `specs/`, пишет предложения |
| **Планировщик** | Читает спецификации для требований, создаёт `tasks.md` в изменениях |
| **Архитектор** | Пишет `design.md` в предложениях изменений |
| **Разработчик** | Реализует согласно спецификациям, обновляет дельты спецификаций |
| **Ревьюер** | Проверяет соответствие требованиям спецификаций |

## Советы

1. **Начинайте с спецификаций** — перед реализацией читайте существующие спецификации
2. **Создавайте предложения** — для новых функций создавайте предложения изменений
3. **Обновляйте спецификации** — после реализации обновляйте спецификации
4. **Следуйте workflow** — Draft → Review → Implement → Complete → Archive
5. **Используйте формат** — следуйте формату спецификаций для консистентности
