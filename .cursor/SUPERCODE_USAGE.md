# Руководство по использованию Supercode.sh в StaffProBot

## Быстрый старт

### 1. Установка
См. `.cursor/SUPERCODE_SETUP.md` - подробная инструкция по установке.

### 2. Настройка режимов
1. Открыть `Supercode: Create Custom Mode`
2. Создать три режима и вставить системные промпты из **`.cursor/SUPERCODE_SETUP.md`**:
   - `StaffPro Architect`
   - `Roadmap Executor`
   - `Refactor & Review`

### 3. Создание workflows
Создать workflows в Supercode UI по описаниям из **`.cursor/SUPERCODE_SETUP.md`**.

## Ежедневное использование

### Утренний ритуал
1. **Выбрать режим "Roadmap Executor"**
2. **Запустить workflow "Новая задача из roadmap"**
3. Работать в выбранном режиме весь день

### Работа над задачей
1. Workflow автоматически найдёт текущую задачу из `doc/plans/roadmap.md`
2. Предложит план реализации
3. После подтверждения реализует задачу
4. Обновит roadmap.md
5. Подготовит сообщение для коммита

### Перед коммитом
1. **Переключиться на режим "Refactor & Review"**
2. Проверить код на:
   - Типизацию (100% type hints)
   - Дублирование (DRY)
   - SOLID принципы
   - Обработку ошибок
3. Запустить `read_lints`
4. Запустить тесты

### При архитектурных вопросах
1. **Переключиться на режим "StaffPro Architect"**
2. Задать вопрос о коде/архитектуре
3. Режим проверит соблюдение правил:
   - user_id vs telegram_id
   - Роутинг и префиксы ролей
   - Шаблоны Jinja2
   - Сессии БД
   - URLHelper

## Автоматические проверки

### При изменении `apps/web/routes/**/*.py`
Автоматически запускается workflow "Проверка правок в routes":
- Проверка префиксов ролей
- Проверка дублирующих роутов
- Проверка использования правильных зависимостей
- Предложение исправлений

### При изменении `shared/**/*.py` или `domain/**/*.py`
Автоматически запускается workflow "Правки в shared/domain":
- Определение контейнеров для перезапуска
- Предложение команд для тестирования
- Проверка кэша Redis

## Режимы и когда их использовать

### StaffPro Architect
**Когда использовать:**
- Перед началом работы над новой функцией
- При изменении архитектуры
- При работе с роутами, шаблонами, сессиями БД
- При сомнениях в правильности реализации

**Что проверяет:**
- Соблюдение правил user_id
- Правильность роутинга
- Использование правильных зависимостей
- Соответствие архитектуре проекта

### Roadmap Executor
**Когда использовать:**
- В начале рабочего дня
- При работе над задачами из roadmap.md
- Когда нужно строго следовать плану

**Что делает:**
- Находит текущую задачу
- Предлагает план реализации
- Реализует после подтверждения
- Обновляет roadmap.md
- Готовит коммит

### Refactor & Review
**Когда использовать:**
- Перед коммитом
- При рефакторинге кода
- При ревью изменений
- При улучшении качества кода

**Что проверяет:**
- Типизацию
- Дублирование кода
- SOLID принципы
- Обработку ошибок
- Логирование

## Workflows

### Новая задача из roadmap
**Запуск**: Ручной через Supercode UI  
**Режим**: Roadmap Executor

**Шаги:**
1. Находит текущую задачу
2. Предлагает план
3. Реализует после подтверждения
4. Проверяет качество
5. Обновляет roadmap.md
6. Готовит коммит

### Проверка правок в routes
**Запуск**: Автоматический при изменении `apps/web/routes/**/*.py`  
**Режим**: StaffPro Architect

**Проверяет:**
- Префиксы ролей
- Дублирующие роуты
- Использование шаблонов
- Сессии БД
- URLHelper

### Правки в shared/domain
**Запуск**: Автоматический при изменении `shared/**/*.py` или `domain/**/*.py`  
**Режим**: StaffPro Architect

**Определяет:**
- Контейнеры для перезапуска
- Команды для тестирования
- Необходимость очистки кэша

## Советы и лучшие практики

### 1. Всегда работай в режиме
Не работай без выбранного режима - каждый режим добавляет контекст и правила.

### 2. Используй workflows для типовых задач
Не дублируй работу - используй готовые workflows для стандартных сценариев.

### 3. Проверяй перед коммитом
Всегда переключайся на "Refactor & Review" перед коммитом для проверки качества.

### 4. Следуй roadmap строго
Используй "Roadmap Executor" для строгого следования плану - не перепрыгивай задачи.

### 5. При сомнениях — проверяй по коду
- Сделай точный поиск по репозиторию (имя функции/класса/эндпоинта).
- Прочитай релевантные файлы целиком.
- Сверься с `.cursor/rules/staffprobot.mdc` (критические запреты и паттерны).

## Решение проблем

### Режим не работает как ожидается
1. Проверить системный промпт в настройках режима
2. Убедиться, что промпт скопирован полностью из `.cursor/supercode_modes/*.md`
3. Перезапустить Cursor

### Workflow не запускается автоматически
1. Проверить настройки триггеров в Supercode UI
2. Убедиться, что workflow создан правильно
3. Проверить логи Supercode

### Не находит задачи в roadmap.md
1. Проверить формат roadmap.md
2. Убедиться, что задачи помечены правильно ([ ] для невыполненных)
3. Проверить путь к файлу в настройках workflow

## Дополнительные ресурсы

- `.cursor/SUPERCODE_SETUP.md` - подробная инструкция по установке
- `.cursor/rules/staffprobot.mdc` - единые критические правила проекта (always apply)

---

**Дата создания**: 2026-02-04  
**Версия**: 1.0
